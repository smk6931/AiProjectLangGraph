# ğŸ› ï¸ Trouble Shooting & Problem Solving Log

ê°œë°œ ê³¼ì •ì—ì„œ ë°œìƒí•œ ì£¼ìš” ê¸°ìˆ ì  ì´ìŠˆì™€ í•´ê²° ê³¼ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤.

---

## ğŸ› 1. Python Decorator `NoneType` Error
### ğŸ”´ Issue
`@perform_async_logging` ë°ì½”ë ˆì´í„°ë¥¼ ì ìš©í•œ í•¨ìˆ˜ë“¤(`genai_generate_text` ë“±)ì´ í˜¸ì¶œ ì‹œ `TypeError: 'NoneType' object is not callable` ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë©° ë©ˆì¶¤.

### ğŸ” Root Cause
`app/util/decorators.py` íŒŒì¼ í•˜ë‹¨ì— ë°ì½”ë ˆì´í„° í•¨ìˆ˜ê°€ ì¤‘ë³µ ì •ì˜ë˜ì–´ ìˆì—ˆìœ¼ë©°, **ë§ˆì§€ë§‰ ì •ì˜ëœ í•¨ìˆ˜ì— `return wrapper` êµ¬ë¬¸ì´ ëˆ„ë½**ë˜ì–´ ìˆì—ˆìŒ. ì´ë¡œ ì¸í•´ ë°ì½”ë ˆì´í„°ê°€ ì ìš©ëœ ëª¨ë“  í•¨ìˆ˜ê°€ ì‹¤í–‰ ì‹œ `None`ìœ¼ë¡œ ì¹˜í™˜ë¨.

### âœ… Solution
ì¤‘ë³µë˜ê³  ì˜ëª» ì‘ì„±ëœ ë°ì½”ë ˆì´í„° ì½”ë“œ ë¸”ë¡ì„ ì œê±°í•˜ê³ , ì •ìƒì ì¸ `wrapper` ë°˜í™˜ ë¡œì§ë§Œ ë‚¨ê²¨ í•´ê²°.

---

## ğŸ§Ÿ 2. "Zombie Data" Persistence (Cache Invalidation Failure)
### ğŸ”´ Issue
ë¦¬í¬íŠ¸ ì´ˆê¸°í™” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ì—¬ DBì™€ Redis ë°ì´í„°ë¥¼ ì‚­ì œí–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , UIì—ì„œ ìƒˆë¡œê³ ì¹¨ ì‹œ ê³„ì† ê³¼ê±° ë¦¬í¬íŠ¸ ë°ì´í„°ê°€ í‘œì‹œë¨.

### ğŸ” Root Cause
ì‹œìŠ¤í…œì´ **3ê³„ì¸µ ìºì‹±(Local Memory -> Redis -> DB)**ì„ ì‚¬ìš© ì¤‘ì´ì—ˆìœ¼ë‚˜, ì´ˆê¸°í™” ë¡œì§ì´ DBì™€ Redisë§Œ ì‚­ì œí•˜ê³  **Python í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ì— ë‚¨ì€ `_local_cache`**ë¥¼ ë¹„ìš°ì§€ ì•ŠìŒ.

### âœ… Solution
1.  `app/core/cache.py`ì— `clear_local_cache_by_store` ë° `clear_all_local_cache` í•¨ìˆ˜ ì¶”ê°€.
2.  `reset` API í˜¸ì¶œ ì‹œ DB, Redisë¿ë§Œ ì•„ë‹ˆë¼ **Local Memory Cache**ë„ ê°•ì œë¡œ `clear()` í•˜ë„ë¡ ë¡œì§ ìˆ˜ì •.
3.  Streamlit UI(`st.session_state`)ì˜ ê´€ë ¨ ìƒíƒœ ë³€ìˆ˜ë„ `pop()`í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë°ì´í„°ê¹Œì§€ ì™„ë²½í•˜ê²Œ ì†Œê±°.

---

## ğŸ”— 3. LLM Answer ignoring Web Citations
### ğŸ”´ Issue
`Web Search Node`ê°€ êµ¬ê¸€ ê²€ìƒ‰ì„ í†µí•´ ìœ ìš©í•œ ë§í¬(URL)ë¥¼ ì°¾ì•„ì„œ ì»¨í…ìŠ¤íŠ¸ë¡œ ë„˜ê²¨ì£¼ì—ˆìœ¼ë‚˜, ìµœì¢… ë‹µë³€ ìƒì„±(`Answer Node`) ë‹¨ê³„ì—ì„œ LLMì´ ë‚´ìš©ì„ ìš”ì•½í•˜ë©´ì„œ **ì›ë³¸ ë§í¬ ì •ë³´ë¥¼ ëˆ„ë½**ì‹œí‚´.

### âœ… Solution
`app/inquiry/nodes/answer.py`ì˜ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸(System Prompt)ì— **Strong Constraint(ê°•ë ¥í•œ ì œì•½ì‚¬í•­)** ì¶”ê°€.
> "íŠ¹íˆ, [ë¶„ì„ìš© ë°ì´í„°]ì— í¬í•¨ëœ **URL ë§í¬**ë‚˜ **ì°¸ê³  ì¶œì²˜** ì •ë³´ëŠ” ë‹µë³€ ë‚´ìš©ì—ì„œ ì ˆëŒ€ ëˆ„ë½í•˜ì§€ ë§ê³ , ë‹µë³€ ìµœí•˜ë‹¨ì— **'ğŸŒ ê´€ë ¨ ë§í¬'** ì„¹ì…˜ì„ êµ¬ì„±í•˜ì—¬ ì›ë³¸ ê·¸ëŒ€ë¡œ í¬í•¨ì‹œí‚¬ ê²ƒ."

---

## ğŸ›‘ 4. FastAPI Router 404 Error (URL Duplication)
### ğŸ”´ Issue
ë¦¬í¬íŠ¸ ìƒì„± API í˜¸ì¶œ ì‹œ `404 Not Found` ë°œìƒ.

### ğŸ” Root Cause
`APIRouter(prefix="/report")`ë¡œ ì´ë¯¸ ì ‘ë‘ì–´ê°€ ì„¤ì •ëœ ìƒíƒœì—ì„œ, ì—”ë“œí¬ì¸íŠ¸ ë°ì½”ë ˆì´í„°ì— ë˜ë‹¤ì‹œ `@router.post("/report/generate")`ë¥¼ ì§€ì •í•¨.
-> ìµœì¢… ê²½ë¡œê°€ `/report/report/generate`ë¡œ ì´ì¤‘ ì¤‘ì²©ë¨.

### âœ… Solution
ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œë¥¼ `@router.post("/generate")`ë¡œ ìˆ˜ì •í•˜ì—¬ ì¤‘ë³µ ì œê±°.
