# ğŸ—ï¸ Backend Tech Stack & Database Workflow ì •ë¦¬

## 1. í•µì‹¬ ê¸°ìˆ  ê°œë… ì •ì˜

### ğŸ”¹ SQLAlchemy (ORM & Query Tool)
- **ì—­í• **: Python ì½”ë“œì™€ Database ì‚¬ì´ì˜ **"í†µì—­ì‚¬"**.
- **ì£¼ìš” ê¸°ëŠ¥**:
    - `Models`: Python í´ë˜ìŠ¤ë¡œ DB í…Œì´ë¸” ì •ì˜ (ì„¤ê³„ë„ ì—­í• ).
    - `SessionLocal`: DB ì—°ê²° ì„¸ì…˜ì„ ê´€ë¦¬í•˜ë©° ë°ì´í„° CRUD(ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ)ë¥¼ ìˆ˜í–‰í•˜ëŠ” **"ì¼ê¾¼"**.
    - **ORM ë°©ì‹**: SQLì„ ì§ì ‘ ì“°ì§€ ì•Šê³  `session.add(user)`, `session.query(User)` ì²˜ëŸ¼ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ë°ì´í„° ì¡°ì‘.
    - **Raw SQL ì§€ì›**: ë³µì¡í•œ í†µê³„ ì¿¼ë¦¬ëŠ” `text("SELECT ...")` ì²˜ëŸ¼ ì§ì ‘ ì‹¤í–‰ë„ ê°€ëŠ¥.

### ğŸ”¹ Alembic (Database Migration Tool)
- **ì—­í• **: SQLAlchemy ëª¨ë¸(ì„¤ê³„ë„)ì˜ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•˜ì—¬ ì‹¤ì œ DB êµ¬ì¡°ë¥¼ ë³€ê²½í•´ì£¼ëŠ” **"ì¸í…Œë¦¬ì–´ ì—…ì"**.
- **ì£¼ìš” ê¸°ëŠ¥**:
    - `Revision`: ë³€ê²½ ì‚¬í•­(ì»¬ëŸ¼ ì¶”ê°€ ë“±)ì„ íƒì§€í•˜ì—¬ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ìƒì„±.
    - `Upgrade`: ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆ(í…Œì´ë¸” êµ¬ì¡°) ë³€ê²½.
    - **ì£¼ì˜**: ì˜¤ì§ **"êµ¬ì¡°(Schema)"** ë§Œ ê´€ë¦¬í•˜ë©°, ë°ì´í„°(Row) ë‚´ìš© ìì²´ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠìŒ.

---

## 2. ì˜¬ë°”ë¥¸ ê°œë°œ ì›Œí¬í”Œë¡œìš° (Workflow)

### ğŸš€ í…Œì´ë¸”ì„ ìƒˆë¡œ ë§Œë“¤ê±°ë‚˜ ìˆ˜ì •í•  ë•Œ (Schema Change)
1. **ëª¨ë¸ ì •ì˜**: `app/schemas.py` ë“±ì—ì„œ Python í´ë˜ìŠ¤(`class Manual(Base)...`) ì •ì˜/ìˆ˜ì •.
2. **Alembic í˜¸ì¶œ**: `db.py`ì˜ `Base`ì— ëª¨ë¸ì´ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸.
3. **ë¦¬ë¹„ì „ ìƒì„± (ê³„íšì„œ)**:
   ```bash
   alembic revision --autogenerate -m "ë³€ê²½ ë‚´ìš© ë©”ëª¨"
   ```
   ğŸ‘‰ `alembic/versions` í´ë”ì— `.py` íŒŒì¼ì´ ìë™ ìƒì„±ë¨. (ë‚´ìš© í™•ì¸ í•„ìˆ˜!)
4. **DB ì ìš© (ê³µì‚¬ ì‹¤í–‰)**:
   ```bash
   alembic upgrade head
   ```
   ğŸ‘‰ ì‹¤ì œ DBì— `CREATE TABLE`, `ALTER COLUMN` ë“±ì´ ì‹¤í–‰ë¨.

### ğŸ“¦ ë°ì´í„°ë¥¼ ë„£ê±°ë‚˜ ì¡°íšŒí•  ë•Œ (Data Manipulation)
- **Alembicì„ ì“°ì§€ ì•ŠìŒ!** (ë°ì´í„° ì˜ì—­ì„)
- **SessionLocal ì‚¬ìš©**:
  ```python
  with SessionLocal() as session:
      new_item = Manual(title="ì²­ì†Œë²•", content="...")
      session.add(new_item)  # INSERT
      session.commit()
  ```
- **ëŒ€ëŸ‰ ë°ì´í„°**: `seed_data.py` ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë„ ê²°êµ­ ë‚´ë¶€ì ìœ¼ë¡œ `SessionLocal`ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë°€ì–´ ë„£ìŒ.

---

## 3. ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)

### Q1. `SessionLocal`ë¡œ ë°ì´í„°ë¥¼ ë¹¨ë¦¬ ë„£ëŠ” ê±´ Alembicì´ë‘ ë‹¤ë¥¸ ê±´ê°€ìš”?
> **Yes!** ì™„ì „íˆ ë‹¤ë¦…ë‹ˆë‹¤.
> - **Alembic**: "ê·¸ë¦‡(í…Œì´ë¸”)ì„ ë§Œë“œëŠ” ë„êµ¬" ğŸ”¨
> - **SessionLocal**: "ê·¸ë¦‡ì— ìŒì‹(ë°ì´í„°)ì„ ë‹´ëŠ” ë„êµ¬" ğŸ±
> - ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ë„£ëŠ” ê±´ SQLAlchemyì˜ `Bulk Insert` ê¸°ëŠ¥ì„ ì“°ê±°ë‚˜ ë¡œì§ ìµœì í™”ì˜ ì˜ì—­ì…ë‹ˆë‹¤.

### Q2. Alembic ì—ëŸ¬ "Target database is not up to date"ëŠ” ì™œ ëœ¨ë‚˜ìš”?
> DBì˜ í˜„ì¬ ìƒíƒœì™€ Alembicì˜ ì¥ë¶€(`alembic_version` í…Œì´ë¸”)ê°€ ë§ì§€ ì•Šì•„ì„œì…ë‹ˆë‹¤.
> - í•´ê²°ë²•: `alembic upgrade head`ë¡œ ì¥ë¶€ë¥¼ ë§ì¶”ê±°ë‚˜, ê¼¬ì˜€ì„ ë• `alembic stamp head`ë¡œ ê°•ì œ ë™ê¸°í™”.

### Q3. ì‹¤ë¬´ì—ì„œëŠ” ORMë§Œ ì“°ë‚˜ìš”?
> **No.** í•˜ì´ë¸Œë¦¬ë“œ íŒ¨í„´ì„ ì”ë‹ˆë‹¤.
> - **ê°„ë‹¨í•œ ì €ì¥/ìˆ˜ì •**: ORM (`SessionLocal`) â†’ ì½”ë“œ ê°€ë…ì„±, ì•ˆì „ì„± ìœ„ì£¼.
> - **ë³µì¡í•œ í†µê³„/ì¡°íšŒ**: Raw SQL (`fetch_all`) â†’ ì„±ëŠ¥ ìµœì í™” ìœ„ì£¼.

---

## 4. ì‹¤ë¬´í˜• ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

| ëª©ì  | ëª…ë ¹ì–´ (PowerShell) |
| :--- | :--- |
| ìƒíƒœ í™•ì¸ | `alembic current` |
| ë³€ê²½ ê°ì§€ | `alembic revision --autogenerate -m "ë©”ì‹œì§€"` |
| DB ë°˜ì˜ | `alembic upgrade head` |
| ì‹¤í–‰ ì·¨ì†Œ | `alembic downgrade -1` (í•œ ë‹¨ê³„ ë’¤ë¡œ) |
| ê¼¬ì„ í•´ê²° | `alembic stamp head` (ê°•ì œ ìµœì‹  ì²˜ë¦¬) |
