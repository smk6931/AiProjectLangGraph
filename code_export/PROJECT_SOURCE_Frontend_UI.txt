Project Code Export - Category: Frontend_UI
Generated for Gemini Canvas Analysis


==================================================
FILE_PATH: ui\api_utils.py
==================================================

# ui/api_utils.py
import streamlit as st
import requests

API_BASE_URL = "http://localhost:8080"


def get_api(endpoint: str, params: dict = None):
    """
    HTTP GET ìš”ì²­ ê³µí†µ í•¨ìˆ˜
    """
    try:
        url = f"{API_BASE_URL}{endpoint}"
        response = requests.get(url, params=params)

        if response.status_code == 200:
            return response.json()
        elif response.status_code == 404:
            st.warning("ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (404)")
            return None
        else:
            st.error(f"API ì˜¤ë¥˜ ë°œìƒ: {response.status_code}")
            return None

    except requests.exceptions.ConnectionError:
        st.error("ğŸ”Œ ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.")
        return None
    except Exception as e:
        st.error(f"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None


def post_api(endpoint: str, json_data: dict = None):
    """
    HTTP POST ìš”ì²­ ê³µí†µ í•¨ìˆ˜
    """
    try:
        url = f"{API_BASE_URL}{endpoint}"
        response = requests.post(url, json=json_data)

        if response.status_code in [200, 201]:
            return response.json()
        else:
            # ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬ (ë°±ì—”ë“œ ìƒì„¸ ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´ í‘œì‹œ)
            error_detail = response.json().get('detail', response.status_code)
            st.error(f"ìš”ì²­ ì‹¤íŒ¨: {error_detail}")
            return None

    except requests.exceptions.ConnectionError:
        st.error("ğŸ”Œ ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.")
        return None
    except Exception as e:
        st.error(f"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None



==================================================
FILE_PATH: ui\dashboard.py
==================================================

# app/ui/dashboard.py
import streamlit as st
import pandas as pd
import plotly.express as px
from sales_component import show_sales_dialog
from api_utils import get_api

def dashboard_page():
    # Premium Gradient Header
    st.markdown("<h1> Dashboard</h1>", unsafe_allow_html=True)
    st.caption(f"í™˜ì˜í•©ë‹ˆë‹¤, {st.session_state.get('user_email')}ë‹˜ | ì‹¤ì‹œê°„ ë§¤ì¥ ëª¨ë‹ˆí„°ë§")

    st.divider()

    # 1ï¸âƒ£ ë°ì´í„° ë¡œë“œ
    stores_data = get_api("/store/get")
    if not stores_data:
        st.warning("ë§¤ì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return
    stores = pd.DataFrame(stores_data)

    # [Session State ì´ˆê¸°í™”] ì§€ë„ì™€ ë¦¬ìŠ¤íŠ¸ë°•ìŠ¤ ì—°ë™ì„ ìœ„í•œ ì¸ë±ìŠ¤ ê´€ë¦¬
    if "selected_store_idx" not in st.session_state:
        st.session_state.selected_store_idx = 0

    # 2ï¸âƒ£ ì§€ì  í˜„í™© ì§€ë„ & ë¦¬ìŠ¤íŠ¸ (2ë‹¨ ë ˆì´ì•„ì›ƒ)
    st.subheader("ì „êµ­ ë§¤ì¥ í˜„í™©")

    col_map, col_list = st.columns([3, 1])

    with col_map:
        # Plotly Scatter Map ìƒì„±
        fig = px.scatter_mapbox(
            stores,
            lat="lat",
            lon="lon",
            text="city",  # í…ìŠ¤íŠ¸ë¡œ í‘œì‹œí•  ì»¬ëŸ¼ (ì˜ˆ: ì„œìš¸, ë¶€ì‚°)
            hover_name="store_name",
            hover_data={"city": True, "lat": False,
                        "lon": False, "store_id": True},
            color_discrete_sequence=["#FF4B4B"],
            zoom=6,
            height=600  # ì„¸ë¡œë¡œ ê¸´ ì§€ë„ ë¹„ìœ¨ì— ë§ì¶¤
        )

        # í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ë° ë§ˆì»¤ ì„¤ì •
        fig.update_traces(
            mode='markers+text',
            textposition='top right',
            textfont=dict(size=11, color="white"),
            marker=dict(size=12)
        )

        # ì§€ë„ ìŠ¤íƒ€ì¼ ì„¤ì • (ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ì–´ë‘ìš´ í…Œë§ˆ)
        fig.update_layout(
            mapbox_style="carto-darkmatter",
            margin={"r": 0, "t": 0, "l": 0, "b": 0},
            clickmode='event+select',
            paper_bgcolor="rgba(0,0,0,0)",
            plot_bgcolor="rgba(0,0,0,0)",
            font=dict(color="white")
        )

        # ì§€ë„ ì¶œë ¥ ë° ì„ íƒ ì´ë²¤íŠ¸ ê°ì§€ (ë§ˆìš°ìŠ¤ íœ  ì¤Œ í™œì„±í™”)
        selected_points = st.plotly_chart(
            fig, 
            use_container_width=True, 
            on_select="rerun",
            config={'scrollZoom': True, 'displayModeBar': False}
        )

    # 3ï¸âƒ£ ìš°ì¸¡ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸
    with col_list:
        st.write("#### ğŸª ë§¤ì¥ ì„ íƒ")
        st.caption("ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§€ë„ë¥¼ í´ë¦­í•˜ì„¸ìš”.")
        
        # [Sync] Session Indexë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ íƒ ë™ê¸°í™”
        selected_store_name = st.selectbox(
            "ë§¤ì¥ ëª©ë¡",
            stores["store_name"],
            index=st.session_state.selected_store_idx,
            label_visibility="collapsed",
            key="store_selectbox" # Key ë¶€ì—¬
        )
        
        # Selectboxë¡œ ë³€ê²½ ì‹œì—ë„ Index ì—…ë°ì´íŠ¸ (ì—­ë°©í–¥ ë™ê¸°í™”)
        # í˜„ì¬ ì„ íƒëœ ì´ë¦„ì˜ Index ì°¾ê¸°
        current_idx = stores[stores["store_name"] == selected_store_name].index[0]
        if current_idx != st.session_state.selected_store_idx:
             st.session_state.selected_store_idx = int(current_idx) # int64 -> int ë³€í™˜
        
        store_row_manual = stores.iloc[st.session_state.selected_store_idx]
        
        st.info(f"ğŸ“ **{store_row_manual['city']}**\n\n{store_row_manual['store_name']}")
        
        if st.button("ğŸ“Š ìƒì„¸ ë³´ê¸°", type="primary", use_container_width=True):
             show_sales_dialog(store_row_manual['store_id'], store_row_manual['store_name'])

    # 4ï¸âƒ£ ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    if selected_points and "selection" in selected_points:
        points = selected_points["selection"]["points"]
        if points:
            # í´ë¦­ëœ ì²« ë²ˆì§¸ ì ì˜ ë°ì´í„° ì¶”ì¶œ
            point_data = points[0]
            point_index = point_data.get("point_index")
            
            if point_index is not None and point_index != st.session_state.selected_store_idx:
                # ìƒíƒœ ì—…ë°ì´íŠ¸ í›„ ë¦¬ëŸ° -> ë¦¬ìŠ¤íŠ¸ë°•ìŠ¤ì™€ ì •ë³´ì°½ì´ ê°±ì‹ ë¨
                st.session_state.selected_store_idx = int(point_index) # ì•ˆì „í•˜ê²Œ int ë³€í™˜
                st.rerun()

    st.divider()



==================================================
FILE_PATH: ui\debug_utils.py
==================================================

import streamlit as st


def render_session_state_viewer():
    """
    st.session_stateì˜ ë‚´ìš©ì„ í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ ë³´ì—¬ì£¼ê±°ë‚˜ ìˆ¨ê¸°ëŠ” ë””ë²„ê·¸ ì»´í¬ë„ŒíŠ¸
    """
    # ì„¸ì…˜ ìƒíƒœì— í† ê¸€ ì—¬ë¶€ ì €ì¥
    if "show_session_debug" not in st.session_state:
        st.session_state.show_session_debug = False

    st.divider()

    # í† ê¸€ ë²„íŠ¼ (Flip-Flop)
    # cols = st.columns([1, 4])
    # with cols[0]:
    #     if st.button("ğŸ› ï¸"):
    #         st.session_state.show_session_debug = not st.session_state.show_session_debug
    #         st.rerun()

    # # í‘œì‹œ ì˜ì—­
    # if st.session_state.show_session_debug:
    #     with st.expander("ğŸ” Current Session State Data", expanded=True):
    #         # ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ JSON ì¶œë ¥
    #         state_dict = {k: v for k, v in st.session_state.items()
    #                       if k != "show_session_debug"}
    #         st.json(state_dict)

    #         # ì •ë³´ì„± í…ìŠ¤íŠ¸
    #         st.caption("ì´ íŒ¨ë„ì€ ê°œë°œ ì¤‘ì—ë§Œ í™œì„±í™”í•˜ì—¬ ì„¸ì…˜ ìƒíƒœë¥¼ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")



==================================================
FILE_PATH: ui\guide_page.py
==================================================

import streamlit as st
import pandas as pd
from api_utils import get_api

def guide_page():
    st.title("ğŸ“š ë§¤ì¥ ìš´ì˜ ê°€ì´ë“œ")
    st.markdown("ë§¤ì¥ ìš´ì˜ì— í•„ìš”í•œ **ë§¤ë‰´ì–¼**ê³¼ **ì‚¬ë‚´ ê·œì •**ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

    # íƒ­ ìƒì„±
    tab1, tab2 = st.tabs(["ğŸ› ï¸ ì—…ë¬´ ë§¤ë‰´ì–¼", "ğŸ“‹ ì‚¬ë‚´ ê·œì • (Policy)"])

    # --- TAB 1: ë§¤ë‰´ì–¼ ---
    with tab1:
        st.subheader("ì—…ë¬´ ë§¤ë‰´ì–¼ ì¡°íšŒ")
        
        # ê²€ìƒ‰ì°½
        search_query_manual = st.text_input("ğŸ” ë§¤ë‰´ì–¼ ê²€ìƒ‰ (í‚¤ì›Œë“œ ì…ë ¥)", key="manual_search")
        
        api_res = get_api("/manual/get")
        
        if api_res:
            df_manual = pd.DataFrame(api_res)
            
            # ê²€ìƒ‰ í•„í„°
            if search_query_manual:
                mask = df_manual.apply(lambda x: search_query_manual in str(x['title']) or search_query_manual in str(x['content']), axis=1)
                df_manual = df_manual[mask]
            
            if not df_manual.empty:
                # ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í•‘
                categories = df_manual['category'].unique()
                
                for cat in categories:
                    st.markdown(f"### ğŸ“‚ {cat}")
                    cat_items = df_manual[df_manual['category'] == cat]
                    
                    for _, row in cat_items.iterrows():
                        with st.expander(f"**{row['title']}**"):
                            st.write(row['content'])
                            st.caption(f"Last Updated: {row.get('updated_at', row.get('created_at', ''))}")
            else:
                st.info("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.")
        else:
            st.warning("ë§¤ë‰´ì–¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    # --- TAB 2: ì‚¬ë‚´ ê·œì • ---
    with tab2:
        st.subheader("ì‚¬ë‚´ ê·œì • ë° ì •ì±…")
        
        # ê²€ìƒ‰ì°½
        search_query_policy = st.text_input("ğŸ” ê·œì • ê²€ìƒ‰ (í‚¤ì›Œë“œ ì…ë ¥)", key="policy_search")
        
        api_res_poly = get_api("/policy/get")
        
        if api_res_poly:
            df_policy = pd.DataFrame(api_res_poly)
            
            # ê²€ìƒ‰ í•„í„°
            if search_query_policy:
                mask = df_policy.apply(lambda x: search_query_policy in str(x['title']) or search_query_policy in str(x['content']), axis=1)
                df_policy = df_policy[mask]
            
            if not df_policy.empty:
                # ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í•‘
                categories = df_policy['category'].unique()
                
                for cat in categories:
                    st.markdown(f"### ğŸ›¡ï¸ {cat}")
                    cat_items = df_policy[df_policy['category'] == cat]
                    
                    for _, row in cat_items.iterrows():
                        with st.expander(f"**{row['title']}**"):
                            # ê·œì •ì€ ì¢€ ë” ê°•ì¡°ëœ UI
                            st.info(row['content'], icon="â„¹ï¸")
            else:
                st.info("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.")
        else:
            st.warning("ê·œì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")



==================================================
FILE_PATH: ui\inquiry_page.py
==================================================

import streamlit as st
import requests
import json
import pandas as pd
import altair as alt
import os

# ìŠ¤íƒ€ì¼ íŒŒì¼ ì„í¬íŠ¸ (Root ì‹¤í–‰ ê¸°ì¤€)
try:
    from ui.styles import apply_custom_styles, show_metric_card
except ImportError:
    # í˜¹ì‹œ ëª¨ë¥¼ ê²½ë¡œ ì—ëŸ¬ ëŒ€ë¹„ (ê°™ì€ í´ë”)
    from styles import apply_custom_styles, show_metric_card

# API URL ì„¤ì •
API_BASE_URL = os.getenv("API_BASE_URL", "http://localhost:8080")

# ==============================================================================
# [UI Component 1] LangGraph ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ (Expander)
# ==============================================================================
def show_langgraph_architecture():
    with st.expander("AI Agent ì•„í‚¤í…ì²˜ (Processing Flow)", expanded=False):
        st.markdown("""
        <div style="text-align: center; color: #8B949E; margin-bottom: 10px;">
            User Intent Analysis â” Route Optimization â” Specialized Retrieval â” Synthesis
        </div>
        """, unsafe_allow_html=True)

# ... (ì¤‘ëµ) ...

# ==============================================================================
# [UI Component 2] ì¶”ì²œ í”„ë¡¬í”„íŠ¸ & ë¡œê·¸
# ==============================================================================
def show_sample_prompts():
    """ì¶”ì²œ í”„ë¡¬í”„íŠ¸ ì„¹ì…˜"""
    with st.expander("ì¶”ì²œ ì§ˆë¬¸ (Click to Copy)", expanded=False):
        c1, c2 = st.columns(2)
        with c1:
            st.caption("ë§¤ì¶œ ë¶„ì„")
            st.code('ì„œìš¸ê°•ë‚¨ì ì˜ ìµœê·¼ ë§¤ì¶œ í•˜ë½ ì›ì¸ì„ ë©”ë‰´ë³„ë¡œ ë¶„ì„í•´ì¤˜', language=None)
            st.code('ìµœê·¼ 1ì£¼ì¼ê°„ ê°€ì¥ ì˜íŒ”ë¦° ë©”ë‰´ Top 5ì™€ ê·¸ ì´ìœ ë¥¼ ë¦¬ë·° ê¸°ë°˜ìœ¼ë¡œ ì•Œë ¤ì¤˜', language=None)
            st.code('ë¶€ì‚°ì ê³¼ ì„œìš¸ì ì˜ ë§¤ì¶œê³¼ ë¦¬ë·°ë¥¼ ë¹„êµí•´ì„œ ê°œì„ ì ì„ ì œì•ˆí•´ì¤˜', language=None)
        with c2:
            st.caption("ë§¤ë‰´ì–¼ & ê·œì •")
            st.code('ê³ ê°ì´ í™˜ë¶ˆì„ ìš”êµ¬í•  ë•Œ ê·œì •ê³¼ ì‘ëŒ€ ë©˜íŠ¸ ì•Œë ¤ì¤˜', language=None)
            st.code('ì˜¤í”ˆ ì¡°ì™€ ë§ˆê° ì¡°ê°€ í•´ì•¼ í•  í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ”?', language=None)
            # st.code('ë§¤ì¥ ìœ„ìƒ ì ê²€ í•­ëª© ë¦¬ìŠ¤íŠ¸ì™€ ì¤€ë¹„ë¬¼ ìš”ì•½í•´ì¤˜', language=None)
            # st.code('ì‹ ê·œ ì•„ë¥´ë°”ì´íŠ¸ìƒ êµìœ¡ ì‹œ ê°•ì¡°í•´ì•¼ í•  ë³µì¥ ê·œì •ì€?', language=None)
            st.code('ì„œìš¸ ì¢…ë¡œêµ¬ì˜ ì§œì¥ë©´ ë§›ì§‘ ì¶”ì²œí•´ì¤˜ (ì›¹ ê²€ìƒ‰)', language=None)

def show_recent_logs():
    """ìµœê·¼ ê²€ìƒ‰ì–´ ì„¹ì…˜"""
    with st.expander("ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ (Recent Activity)", expanded=False):
        if "messages" in st.session_state and len(st.session_state.messages) > 1:
            recent = [m["content"] for m in reversed(st.session_state.messages) if m["role"]=="user"][:5]
            for r in recent: st.text(f"ğŸ” {r}")
        else:
            st.info("No recent activity.")

# ==============================================================================
# [Logic] AI ë©”ì‹œì§€ ë Œë”ë§ (Custom CSS ì ìš©)
# ==============================================================================
def display_ai_message(message_content):
    """
    AI ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ì¹´ë“œí˜• UI, ì°¨íŠ¸ ë“±ìœ¼ë¡œ ë Œë”ë§
    """
    json_data = None
    
    # 1. Parsing ì‹œë„
    try:
        if isinstance(message_content, dict):
            json_data = message_content
        elif isinstance(message_content, str):
            # í˜¹ì‹œ ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡(```json ... ```)ìœ¼ë¡œ ê°ì‹¸ì ¸ ìˆì„ ê²½ìš° ì œê±°
            clean_content = message_content.strip()
            if clean_content.startswith("```json"):
                clean_content = clean_content[7:]
            if clean_content.endswith("```"):
                clean_content = clean_content[:-3]
            
            json_data = json.loads(clean_content)
    except json.JSONDecodeError:
        # JSONì´ ì•„ë‹Œ ì¼ë°˜ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ (ë‹¨ìˆœ ì¶œë ¥)
        st.markdown(message_content)
        return
    except Exception as e:
        st.error(f"Error parsing response: {e}")
        st.code(message_content)
        return

    # 2. ë Œë”ë§ ë¡œì§ (íŒŒì‹± ì„±ê³µ ì‹œ)
    try:
        if not json_data:
            st.markdown(str(message_content))
            return

        # (1) Key Metrics (ì¹´ë“œ UI)
        if "key_metrics" in json_data and json_data["key_metrics"]:
            metrics = json_data["key_metrics"]
            # ë¦¬ìŠ¤íŠ¸í˜• ì²˜ë¦¬
            if isinstance(metrics, dict):
                 m_list = [{"label": k, "value": v} for k, v in metrics.items()]
            else:
                 m_list = metrics
            
            if m_list:
                cols = st.columns(len(m_list[:3]))
                for i, m in enumerate(m_list[:3]):
                    show_metric_card(
                        cols[i], 
                        label=str(m.get("label") or m.get("title", "Metric")), 
                        value=str(m.get("value")), 
                        delta=str(m.get("delta")) if m.get("delta") else None
                    )
                st.markdown("---")

        # (2) Chart Rendering
        if "chart_data" in json_data and json_data["chart_data"]:
            title = json_data.get("chart_setup", {}).get("title", "ë°ì´í„° ì‹œê°í™”")
            st.markdown(f"#### ğŸ“Š {title}")
            
            c_data = json_data["chart_data"]
            if isinstance(c_data, list) and len(c_data) > 0:
                df = pd.DataFrame(c_data)
                
                # Chart Setup ì •ë³´ í™œìš©
                c_setup = json_data.get("chart_setup", {})
                x_col = c_setup.get("x", "date") # ê¸°ë³¸ê°’ date
                y_col = c_setup.get("y", "sales") # ê¸°ë³¸ê°’ sales
                
                # ì»¬ëŸ¼ì´ ì‹¤ì œ ë°ì´í„°ì— ìˆëŠ”ì§€ í™•ì¸ (ì—†ìœ¼ë©´ ì²«ë²ˆì§¸, ë‘ë²ˆì§¸ ì»¬ëŸ¼ ì‚¬ìš©)
                if x_col not in df.columns: x_col = df.columns[0]
                if y_col not in df.columns and len(df.columns) > 1: y_col = df.columns[1]

                # Altair Chart (Dynamic Coloring)
                base = alt.Chart(df).mark_bar(cornerRadiusTopLeft=5, cornerRadiusTopRight=5).encode(
                    x=alt.X(f'{x_col}:O', title=x_col.upper(), axis=alt.Axis(labelAngle=0)),
                    y=alt.Y(f'{y_col}:Q', title=y_col.upper()),
                    tooltip=list(df.columns)
                )

                if "store" in df.columns:
                    # ì§€ì ë³„ ë¹„êµ ì‹œ ìƒ‰ìƒ êµ¬ë¶„ (Legend ìë™ ìƒì„±)
                    chart = base.encode(color=alt.Color("store:N", title="ì§€ì "))
                else:
                    # ë‹¨ì¼ ì§€ì  ì‹œ ë‹¨ìƒ‰
                    chart = base.encode(color=alt.value("#4facfe"))
                
                chart = chart.properties(height=300)
                st.altair_chart(chart, use_container_width=True)

        # (3) Text Content
        if "answer" in json_data:
            st.markdown(json_data['answer'])
        elif "summary" in json_data:
            st.info(f"ğŸ’¡ **Insight**: {json_data['summary']}")
            
        # (4) References
        if "used_docs" in json_data and json_data["used_docs"]:
             with st.expander("ğŸ“š Referenced Sources (ì°¸ê³  ìë£Œ)"):
                 for d in json_data["used_docs"]:
                     if "http" in d:
                         # URL Link Parsing
                         parts = d.split("http")
                         text_title = parts[0].strip(" -[]")
                         url = "http" + parts[1].split()[0].rstrip(")")
                         
                         title = text_title if text_title else "External Link"
                         st.markdown(f"- ğŸ”— [{title}]({url})")
                     else:
                         st.markdown(f"- {d}")

        if "used_reviews" in json_data:
             revs = json_data["used_reviews"]
             if revs:
                 with st.expander(f"ğŸ’¬ ê³ ê° ë¦¬ë·° ê·¼ê±° ({len(revs)}ê±´)"):
                      for r in revs[:5]:
                          st.caption(f"{r.get('ordered_at', '')[:10]} | {r.get('menu_name', '')}")
                          st.markdown(f"**{'â­'*int(r.get('rating',0))}**: {r.get('review_text')}")
                          st.divider()

    except Exception as e:
        st.error(f"Render Error: {e}")
        st.write(json_data)
            
# ... (ì¤‘ëµ) ...

# ==============================================================================
# [Page] ë©”ì¸ í˜ì´ì§€ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
# ==============================================================================
def inquiry_page():
    # 1. Custom CSS ì ìš©
    apply_custom_styles()
    
    # 2. Header Area
    st.markdown("<h1>AI Franchise Manager</h1>", unsafe_allow_html=True)
    st.caption("LLM & LangGraph ê¸°ë°˜ ì§€ëŠ¥í˜• ë§¤ì¥ ìš´ì˜ ì§€ì› ì‹œìŠ¤í…œ")
    
    # 3. Top Components
    show_langgraph_architecture()
    show_sample_prompts()
    show_recent_logs()
    
    st.divider()

    # 4. Session Init
    if "messages" not in st.session_state:
        st.session_state.messages = [{
            "role": "assistant", 
            "content": "ì•ˆë…•í•˜ì„¸ìš”! ì ì£¼ë‹˜, ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?\n\në°ì´í„° ë¶„ì„, ë§¤ì¥ ê·œì •, ê³ ê° ì‘ëŒ€ ë“± ê¶ê¸ˆí•œ ì ì„ í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”."
        }]

    # 5. Chat History Render
    for msg in st.session_state.messages:
        with st.chat_message(msg["role"]):
            if "logs" in msg:
                # ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì‘ê³  ê¹”ë”í•˜ê²Œ
                with st.status("âœ… Analysis Process", expanded=False, state="complete") as s:
                    for l in msg["logs"]: 
                         st.write(f"ğŸ”¹ {l['message']}")
            if msg["content"]:
                display_ai_message(msg["content"])

    # 6. User Input
    if prompt := st.chat_input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."):
        st.session_state.messages.append({"role": "user", "content": prompt})
        st.chat_message("user").markdown(prompt)
        
        # --- [Phase 1: Check] ---
        with st.chat_message("assistant"):
            with st.status("ğŸ•µï¸ Analyzing your inquiry...", expanded=True) as status:
                try:
                    res = requests.post(f"{API_BASE_URL}/inquiry/check", json={"store_id": 1, "question": prompt})
                    if res.status_code == 200:
                        data = res.json()["data"]
                        status.update(label="Analysis Complete. Please select an action.", state="complete", expanded=False)
                        st.session_state.pending_inquiry = {"question": prompt, "data": data}
                        st.rerun()
                    else:
                        status.update(label="Server Error", state="error")
                except Exception as e:
                    status.update(label=f"Connection Error: {e}", state="error")

    # 7. [Phase 2: Action Selection]
    if "pending_inquiry" in st.session_state:
        pending = st.session_state.pending_inquiry
        # data ë³€ìˆ˜ ì œê±°í•˜ê³  ì§ì ‘ ì ‘ê·¼
        category = pending["data"].get("category", "general")
        question = pending["question"]
        
        with st.chat_message("assistant"):
            # ê¹”ë”í•œ Action Card
            st.markdown(f"""
            <div style="background-color: #1F242C; border: 1px solid #4facfe; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                <h3 style="margin:0; color: #4facfe;">ğŸš€ {category.upper()} Analysis</h3>
                <p style="color: #8B949E; margin-top: 5px;">ì§ˆë¬¸ì˜ ì˜ë„ë¥¼ íŒŒì•…í•˜ê³  ê´€ë ¨ ë°ì´í„°ë¥¼ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>
            """, unsafe_allow_html=True)
            
            if category == "sales":
                # [ë¶„ì„ ì •ë³´ ë¯¸ë¦¬ë³´ê¸°] ì§ì ‘ ì ‘ê·¼ ë°©ì‹ ì‚¬ìš©
                if pending["data"].get("sales_data"):
                    st.info(f"""
                    **ğŸ“‹ ë¶„ì„ ê³„íš (Execution Plan)**
                    - **Target Store**: {pending["data"]["sales_data"].get("target_store_name") or "ì „ì²´ ì§€ì "}
                    - **Data Sources**: Sales(ë§¤ì¶œ), Reviews(ë¦¬ë·°), Menus(ë©”ë‰´)
                    - **Analysis Type**: Trend & Performance
                    """)
                else:
                    st.write("ë§¤ì¶œ ë°ì´í„°ë¥¼ ì‹¬ì¸µ ë¶„ì„í•˜ì—¬ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.")
                c1, c2 = st.columns([1, 1])
                if c1.button("ë¶„ì„ ì‹œì‘", type="primary", use_container_width=True):
                    st.session_state.processing_mode = "db"
                    # [Optimization] ì´ë¯¸ ê°€ì ¸ì˜¨ Sales Dataë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ Contextì— ì „ë‹¬
                    sales_payload = [pending["data"].get("sales_data", {})]
                    st.session_state.processing_meta = {"question": question, "category": category, "context": sales_payload}
                    del st.session_state.pending_inquiry
                    st.rerun()
                if c2.button("ì·¨ì†Œ", use_container_width=True):
                    del st.session_state.pending_inquiry
                    st.rerun()
            else: # Manual / Policy
                candidates = pending["data"].get("candidates", [])
                st.write(f"ğŸ” **{len(candidates)}**ê±´ì˜ ê´€ë ¨ ë¬¸ì„œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.")
                
                # [AI Recommendation]
                recommendation = pending["data"].get("recommendation", {})
                if recommendation and recommendation.get("comment"):
                    rec_msg = recommendation["comment"]
                    if "ì›¹ ê²€ìƒ‰" in rec_msg or "ë‚®ìŠµë‹ˆë‹¤" in rec_msg:
                        st.warning(f"{rec_msg}")
                    else:
                        st.success(f"{rec_msg}")
                
                selected_docs = []
                if candidates:
                    st.markdown("---")
                    st.caption("ì°¸ê³ í•  ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš” (ì²´í¬ë°•ìŠ¤):")
                    
                    for c in candidates:
                        # íŒŒì‹±: [ì œëª©] (ìœ ì‚¬ë„: 0.xx) í˜•íƒœë¼ê³  ê°€ì •
                        first_line = c.split('\n')[0]
                        # ì œëª©ê³¼ ìƒì„¸ ë‚´ìš© ë¶„ë¦¬
                        title = first_line
                        score_text = ""
                        
                        if "(ìœ ì‚¬ë„:" in first_line:
                            parts = first_line.split("(ìœ ì‚¬ë„:")
                            title = parts[0].strip()
                            score_text = f"(ìœ ì‚¬ë„: {parts[1].replace(')', '').strip()})"
                        
                        # ì¹´ë“œ ìŠ¤íƒ€ì¼ ë°°ê²½
                        col_chk, col_txt = st.columns([0.1, 0.9])
                        with col_chk:
                             # Default True
                             is_checked = st.checkbox("Select", value=True, key=c[:20], label_visibility="collapsed")
                        
                        with col_txt:
                             # Custom Style
                             st.markdown(f"""
                             <div style="
                                 background-color: #161B22; 
                                 padding: 10px; 
                                 border-radius: 8px; 
                                 border: 1px solid #30363D; 
                                 display: flex; 
                                 justify-content: space-between; 
                                 align-items: center;
                                 margin-bottom: 5px;">
                                 <span style="font-weight: bold; color: #E6EDF3;">ğŸ“„ {title}</span>
                                 <span style="font-size: 0.8em; color: #4facfe; background-color: rgba(79, 172, 254, 0.1); padding: 2px 8px; border-radius: 12px;">
                                     {score_text}
                                 </span>
                             </div>
                             """, unsafe_allow_html=True)
                             # ìƒì„¸ ë‚´ìš© (ì˜µì…˜: ë„ˆë¬´ ê¸¸ë©´ ìƒëµí•˜ê±°ë‚˜ expanderë¡œ)
                             # with st.expander("ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°"):
                             #    st.text(c)
                        
                        if is_checked:
                             selected_docs.append(c)
                    
                    st.markdown("---")
                
                c1, c2 = st.columns([1, 1])
                if c1.button("ë‹µë³€ ìƒì„±", type="primary", use_container_width=True):
                    st.session_state.processing_mode = "db"
                    st.session_state.processing_meta = {"question": question, "category": category, "context": selected_docs}
                    del st.session_state.pending_inquiry
                    st.rerun()
                if c2.button("ì›¹ ê²€ìƒ‰ (Google)", use_container_width=True):
                    st.session_state.processing_mode = "web"
                    st.session_state.processing_meta = {"question": question, "category": category, "context": []}
                    del st.session_state.pending_inquiry
                    st.rerun()

    # 8. [Phase 3: Generation]
    if "processing_mode" in st.session_state:
        meta = st.session_state.processing_meta
        
        with st.chat_message("assistant"):
            st_status = st.status("Generating Response...", expanded=True)
            full_resp = ""
            logs = []
            
            try:
                # ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­
                res = requests.post(f"{API_BASE_URL}/inquiry/generate/stream", json={
                    "store_id": 1,
                    "question": meta["question"],
                    "category": meta["category"],
                    "mode": st.session_state.processing_mode,
                    "context_data": meta["context"]
                }, stream=True)
                
                final_obj = None
                for line in res.iter_lines():
                    if line:
                        try:
                            d = json.loads(line.decode('utf-8'))
                            if "step" in d and d["step"] != "done":
                                msg = d.get("message", "")
                                st_status.write(f"ğŸ”¹ {msg}")
                                logs.append(d)
                            if "final_answer" in d:
                                final_obj = d["final_answer"]
                        except: continue
                
                st_status.update(label="Complete!", state="complete", expanded=False)
                
                if final_obj:
                    # JSON ì§ë ¬í™”
                    full_resp = json.dumps(final_obj) if isinstance(final_obj, (dict, list)) else final_obj
                    display_ai_message(full_resp)
                    st.session_state.messages.append({
                        "role": "assistant", 
                        "content": full_resp, 
                        "logs": logs
                    })
                else:
                    st.error("Failed to generate answer.")
            except Exception as e:
                st.error(f"Error: {e}")
        
        del st.session_state.processing_mode
        del st.session_state.processing_meta
        st.rerun()

    # Sidebar
    with st.sidebar:
        st.caption("Developed with LangGraph")
        if st.button("Reset Conversation", use_container_width=True):
            st.session_state.messages = []
            st.rerun()



==================================================
FILE_PATH: ui\login.py
==================================================

# app/ui/login.py
import streamlit as st
from api_utils import post_api


def login_page():
    st.title("ğŸ” Login")

    email = st.text_input("Email")
    password = st.text_input("Password", type="password")

    if st.button("Login"):
        res_data = post_api("/user/login", json_data={"email": email})

        if res_data:
            st.session_state.user_email = email
            st.session_state.page = "dashboard"
            st.rerun()

    st.button("íšŒì›ê°€ì…", on_click=lambda: go_register())


def go_register():
    st.session_state.page = "register"



==================================================
FILE_PATH: ui\main_ui.py
==================================================

from debug_utils import render_session_state_viewer
from menu_page import menu_page
from review_page import review_page
from dashboard import dashboard_page
from register import register_page
from login import login_page
from inquiry_page import inquiry_page
from guide_page import guide_page
import streamlit as st
import sys
import os

# ui ë””ë ‰í† ë¦¬ë¥¼ pathì— ì¶”ê°€ (í•„ìš”ì‹œ)
st.session_state.user_email = "email"

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

st.set_page_config(page_title="AI Project", layout="wide")

# ìŠ¤íƒ€ì¼ ì ìš© (ì „ì—­)
try:
    from styles import apply_custom_styles
    apply_custom_styles()
except ImportError:
    pass

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "page" not in st.session_state:
    st.session_state.page = "inquiry_page" # AI ë§¤ë‹ˆì €ë¥¼ ë©”ì¸ìœ¼ë¡œ ì„¤ì •

# ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ (ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš°)
if "user_email" not in st.session_state:
    if st.session_state.page not in ["login", "register"]:
        st.session_state.page = "login"

# --- ì‚¬ì´ë“œë°” ë‚´ë¹„ê²Œì´ì…˜ (ë¡œê·¸ì¸í•œ ê²½ìš°ë§Œ í‘œì‹œ) ---
if "user_email" in st.session_state:
    with st.sidebar:
        st.title("ê´€ë¦¬ ë©”ë‰´")
        st.markdown("í™˜ì˜í•©ë‹ˆë‹¤, **ì ì£¼ë‹˜**!")
        
        st.divider()

        # í˜ì´ì§€ ì´ë¦„ê³¼ ë‚´ë¶€ í‚¤ ë§¤í•‘
        nav_options = {
            "AI ë§¤ë‹ˆì € (Main)": "inquiry_page", 
            "ì´ë§¤ì¶œ/AI ë¶„ì„": "dashboard",
            "ë©”ë‰´ ì¡°íšŒ": "menu_page",
            "ë¦¬ë·° ê´€ë¦¬": "review_page",
            "ë§¤ë‰´ì–¼ & ê·œì •": "guide_page",
            "ğŸ‘¨â€ğŸ’» ê°œë°œì ë…¸íŠ¸ (Portfolio)": "portfolio_page"
        }

        # í˜„ì¬ í˜ì´ì§€ì˜ index ì°¾ê¸°
        current_idx = 0
        current_page = st.session_state.page
        
        # ê°’ì´ ì—†ëŠ” ê²½ìš°(ì˜ˆ: ì™¸ë¶€ ìš”ì¸ìœ¼ë¡œ í˜ì´ì§€ê°€ ë°”ë€ ê²½ìš°) ë°©ì–´
        if current_page not in nav_options.values():
            current_page = "inquiry_page"
            
        for i, val in enumerate(nav_options.values()):
            if val == current_page:
                current_idx = i
                break

        selection = st.radio(
            "ì´ë™í•˜ê¸°",
            list(nav_options.keys()),
            index=current_idx,
            label_visibility="collapsed"
        )
        
        st.session_state.page = nav_options[selection]

        # st.divider()
        # if st.button("ë¡œê·¸ì•„ì›ƒ"):
        #     st.session_state.clear()
        #     st.session_state.page = "login"
        #     st.rerun()

        # --- ë””ë²„ê·¸ ì„¸ì…˜ ì¡°íšŒ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€ ---
        render_session_state_viewer()

# --- í˜ì´ì§€ ë¼ìš°íŒ… ---
if st.session_state.page == "login":
    login_page()

elif st.session_state.page == "register":
    register_page()

elif st.session_state.page == "dashboard":
    dashboard_page()

elif st.session_state.page == "inquiry_page":
    inquiry_page()

elif st.session_state.page == "menu_page":
    menu_page()

elif st.session_state.page == "review_page":
    review_page()

elif st.session_state.page == "guide_page":
    guide_page()

elif st.session_state.page == "portfolio_page":
    from portfolio_page import render_portfolio_page
    render_portfolio_page()



==================================================
FILE_PATH: ui\menu_page.py
==================================================

import streamlit as st
import pandas as pd
from api_utils import get_api

def menu_page():
    # ìŠ¤íƒ€ì¼ ì„í¬íŠ¸
    try: from styles import show_metric_card
    except ImportError: from ui.styles import show_metric_card

    st.markdown("<h1>ğŸ´ Menu Management</h1>", unsafe_allow_html=True)
    st.caption("Centralized Menu Database & Pricing Overview")

    menu_data = get_api("/menu/get")

    if menu_data:
        # DataFrameìœ¼ë¡œ ë³€í™˜
        df = pd.DataFrame(menu_data)
        
        # [UX] ë¶ˆí•„ìš”í•œ embedding ë°ì´í„° ìˆ¨ê¸°ê¸°
        if 'embedding' in df.columns:
            df = df.drop(columns=['embedding'])

        # ì»¬ëŸ¼ í•œê¸€í™”
        column_mapping = {
            "menu_id": "ID",
            "menu_name": "ë©”ë‰´ëª…",
            "category": "ì¹´í…Œê³ ë¦¬",
            "cost_price": "ì›ê°€",
            "list_price": "ì •ê°€",
            "main_ingredient": "ì£¼ì¬ë£Œ",
            "is_seasonal": "ì‹œì¦Œì—¬ë¶€",
            "description": "ì„¤ëª…"
        }

        # ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ë§Œ ë§¤í•‘
        df_display = df.rename(
            columns={k: v for k, v in column_mapping.items() if k in df.columns})

        # í•„í„°ë§ UI
        cols = st.columns(2)
        with cols[0]:
            category_filter = st.multiselect(
                "ì¹´í…Œê³ ë¦¬ ì„ íƒ", options=df_display["ì¹´í…Œê³ ë¦¬"].unique())

        if category_filter:
            df_display = df_display[df_display["ì¹´í…Œê³ ë¦¬"].isin(category_filter)]

        # ë°ì´í„° í…Œì´ë¸” í‘œì‹œ
        st.dataframe(df_display, width='stretch')

        # ìƒì„¸ ìš”ì•½ í†µê³„
        st.divider()
        st.subheader("ğŸ“Š ë©”ë‰´ í†µê³„")
        col1, col2, col3 = st.columns(3)
        show_metric_card(col1, "ì „ì²´ ë©”ë‰´ ìˆ˜", str(len(df)))

        avg_price = df['list_price'].mean() if 'list_price' in df and not df['list_price'].isnull().all() else 0
        show_metric_card(col2, "í‰ê·  ê°€ê²©", f"{avg_price:,.0f}ì›")

        seasonal_count = len(df[df['is_seasonal'] == True]) if 'is_seasonal' in df else 0
        show_metric_card(col3, "ì‹œì¦Œ ë©”ë‰´ ìˆ˜", str(seasonal_count))
    else:
        st.info("ë©”ë‰´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")



==================================================
FILE_PATH: ui\portfolio_page.py
==================================================

import streamlit as st
import os

def render_portfolio_page():
    # --- ì œëª© ì„¹ì…˜ ---
    st.title("ğŸ‘¨â€ğŸ’» Developer's Technical Whitepaper")
    st.caption("AI Franchise Manager Project Portfolio (2024.12 ~ 2025.01)")
    
    st.divider()

    # --- ë ˆì´ì•„ì›ƒ êµ¬ì„±: ì™¼ìª½(ëª©ì°¨) / ì˜¤ë¥¸ìª½(ë‚´ìš©) ---
    col_nav, col_content = st.columns([1, 3])

    with col_nav:
        st.subheader("ğŸ“š Table of Contents")
        
        # ëª©ì°¨ ë¦¬ìŠ¤íŠ¸ ì •ì˜
        chapters = {
            "1. Project Overview": "intro",
            "2. Planning Intent": "intent",
            "3. Tech Stack Strategy": "stack",
            "4. Database Schema": "schema",
            "5. System Architecture": "architecture",
            "6. API Specification": "api",
            "7. Feat: Report Agent": "feat_report",
            "8. Feat: Inquiry Agent": "feat_inquiry",
            "9. Log #1: Connectivity": "log_aws",
            "10. Log #2: JSON Parsing": "log_json",
            "11. Log #3: RAG Accuracy": "log_rag",
            "12. Future Roadmap": "roadmap",
            "ğŸ“œ Full Document (Raw)": "raw_doc"
        }
        
        # ë¼ë””ì˜¤ ë²„íŠ¼ìœ¼ë¡œ ì±•í„° ì„ íƒ
        selected_chapter = st.radio(
            "Go to Section:",
            list(chapters.keys()),
            label_visibility="collapsed"
        )
        
        selection_key = chapters[selected_chapter]

    # --- ì½˜í…ì¸  ë Œë”ë§ í•¨ìˆ˜ ---
    with col_content:
        # 1. Project Overview
        if selection_key == "intro":
            st.header("1. ğŸ“˜ Project Overview")
            st.info("**AI Franchise Manager**ëŠ” ê°€ë§¹ì ì£¼ì˜ 'ë°ì´í„° ë¶„ì„'ê³¼ 'ë§¤ë‰´ì–¼ ìˆ™ì§€' ì–´ë ¤ì›€ì„ í•´ê²°í•˜ëŠ” All-in-One AI ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.")
            
            st.markdown("""
            - **Role**: Full Stack Developer & AI Engineer (1ì¸ ê°œë°œ)
            - **Goal**: ë‹¨ìˆœ ëŒ€ì‹œë³´ë“œê°€ ì•„ë‹Œ, **ë¨¼ì € ì œì•ˆí•˜ëŠ”(Proactive) AI Agent** êµ¬í˜„
            - **Key Value**:
                1. **Automation**: í´ë¦­ ì—†ëŠ” ë¦¬í¬íŠ¸ ìë™ ìƒì„±
                2. **Accessibility**: ì±„íŒ…ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ìš´ì˜ Q&A
                3. **Reliability**: Hallucination ì—†ëŠ” ì‹ ë¢°ì„±
            """)

        # 2. Planning Intent
        elif selection_key == "intent":
            st.header("2. ğŸ¯ Planning Intent")
            st.warning("ë¬¸ì œì : ì‚¬ì¥ë‹˜ë“¤ì€ POS ìˆ«ìë¥¼ ë³¼ ë¿, 'ì›ì¸'ì„ ë¶„ì„í•  ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤.")
            st.success("í•´ê²°ì±…: ìš”ë¦¬ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”. ë¶„ì„ì€ AIê°€ ëŒ€ì‹ í•´ì„œ 'ì´ìœ 'ì™€ 'ì „ëµ'ì„ ë– ë¨¹ì—¬ ë“œë¦½ë‹ˆë‹¤.")
            
            st.write("### Why this Project?")
            st.markdown("""
            * **Unmanned Store Trend**: ë¬´ì¸ ë§¤ì¥ ì¦ê°€ë¡œ ì¸í•œ ì›ê²© ê´€ë¦¬ ë‹ˆì¦ˆ í­ë°œ
            * **Complexity**: ë°°ë‹¬ ì•±, POS, ë°œì£¼ ì‹œìŠ¤í…œ... ë„ˆë¬´ ë§ì€ íˆ´ íŒŒí¸í™”
            * **SaaS Opportunity**: ì›” êµ¬ë…í˜• AI ë§¤ë‹ˆì € ì„œë¹„ìŠ¤ì˜ ê°€ëŠ¥ì„± í™•ì¸
            """)

        # 3. Tech Stack
        elif selection_key == "stack":
            st.header("3. ğŸ› ï¸ Tech Stack Strategy")
            
            tab1, tab2, tab3 = st.tabs(["Core (AI)", "Backend", "Infra"])
            
            with tab1:
                st.subheader("Brain: LangGraph")
                st.write("- **Selection Reason**: ë‹¨ìˆœ Chain(Linear)ì„ ë„˜ì–´ **ìˆœí™˜(Loop)ê³¼ ìƒíƒœ(State)** ê´€ë¦¬ê°€ í•„ìˆ˜ì ì¸ ì—ì´ì „íŠ¸ ì„¤ê³„ë¥¼ ìœ„í•´ ë„ì….")
                st.write("- **Models**: OpenAI GPT-4o (ì¶”ë¡ ìš©) + Gemini 1.5 Flash (ëŒ€ëŸ‰ ì²˜ë¦¬ìš©)")
            
            with tab2:
                st.subheader("Server: FastAPI")
                st.write("- **Async**: ë¹„ë™ê¸° ì²˜ë¦¬ì— ìµœì í™”ëœ Python í”„ë ˆì„ì›Œí¬")
                st.write("- **Docs**: Swagger UI ìë™ ìƒì„±ìœ¼ë¡œ API ë¬¸ì„œí™” ë¹„ìš© ì ˆê°")
                
                st.subheader("DB: PostgreSQL + pgvector")
                st.write("- **Unified**: ê´€ê³„í˜• ë°ì´í„°(ë§¤ì¶œ)ì™€ ë²¡í„°(ë§¤ë‰´ì–¼)ë¥¼ ë‹¨ì¼ DBì—ì„œ ì²˜ë¦¬í•˜ì—¬ ê´€ë¦¬ í¬ì¸íŠ¸ ì¼ì›í™”")
            
            with tab3:
                st.subheader("Deploy: AWS EC2")
                st.write("- **Environement**: Ubuntu 22.04 LTS")
                st.write("- **Networking**: SSH Tunneling, TCP/IP Security Group ì„¤ì • ê²½í—˜")

        # 4. Schema
        elif selection_key == "schema":
            st.header("4. ğŸ’¾ Database Schema (ERD)")
            st.markdown("ì •ê·œí™”ëœ ê´€ê³„í˜• ë°ì´í„°ì™€ ë²¡í„° ì„œì¹˜ìš© í…Œì´ë¸”ì˜ í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°ì…ë‹ˆë‹¤.")
            
            # Mermaid ERD (ê°„ì†Œí™”)
            st.graphviz_chart("""
            digraph ERD {
                node [shape=record];
                Stores [label="{Stores|+ store_id (PK)\l+ name\l+ location}"];
                Sales [label="{Sales_Daily|+ sale_id (PK)\l+ date\l+ revenue\l+ weather_tags}"];
                Menus [label="{Menus|+ menu_id (PK)\l+ name\l+ category\l+ price}"];
                Manuals [label="{Manuals (Vector)|+ id\l+ content (Text)\l+ embedding (1536d)}"];
                Reports [label="{Store_Reports|+ report_id\l+ content (JSON)\l+ risk_score}"];

                Stores -> Sales [label="1:N"];
                Stores -> Reports [label="1:N"];
                Menus -> Sales [label="N:N (OrderItems)"];
            }
            """)

        # 5. Architecture
        elif selection_key == "architecture":
            st.header("5. ğŸ—ï¸ System Architecture")
            st.markdown("Queryì˜ ì„±ê²©ì— ë”°ë¼ ë‘ ê°œì˜ ì „ë¬¸ ì—ì´ì „íŠ¸ë¡œ ë¶„ê¸°ë˜ëŠ” **Router Pattern**ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.")
            
            st.image("https://mermaid.ink/img/pako:eNplkktvwjAMx7_KyXlA4tBLB9TuMCG022rTS6w0akpSnAZCffcl5UW7TfH3s_3_bMc5lUYFSpD1q-y0eWDoPFlzch_tW-fM2W2028Z-7IeP8TD0g3C0-zh0_eFjHIbB7iYID8PtdhgGo937OLj70w_3H_vhcPe-96N_20nBChU0hApqqG1eSclz4R_Qk8K51KxQeW6U4rmwUjHheE7JCo2hS-iS1pW1c3-I0hV6Q91QZ-h_oTv0gV7zXCljVqg810rx96nQeO7S-hO05F7W3lD_QvclT9S9Urxk7-Vz6xJ6T89L3hX6E_QoVFaQo1hAhmIOGYp5ZCiWkKFYRoZipQxQk2GAmgyj1GQYoSbDgJoMA9RkGKSmlL5YQYZaGaoVZKjVkKG2ghy1Msql-g9Qk1Eu9X-gJqNcGv5ATUa5NPyBmoxyKfgDNRnlcl0y1N5QuyFD7Q21GzLU3lC7IUOtjHI5_gPUZJRLe4D6X4xyaQ9Qk1Eu7QFqMspv6y-oxSi_rb-AFvN0y2_rL6jFKL-tv4B-i_8BFm0zCQ?type=png")
            st.caption("â–² System Logic Flow (Report / Inquiry Route)")

        # 6. API
        elif selection_key == "api":
            st.header("6. ğŸ”Œ API Specification")
            st.write("RESTful ì›ì¹™ì„ ì¤€ìˆ˜í•˜ë©° FastAPI ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.")
            
            st.code("""
# 1. AI ì±„íŒ… (Streaming)
POST /api/v1/inquiry
Body: { "query": "ë°°ë‹¬ ìˆ˜ìˆ˜ë£Œ ì •ì±… ì•Œë ¤ì¤˜", "store_id": 1 }

# 2. ë¦¬í¬íŠ¸ ìƒì„± (Batch Trigger)
POST /api/v1/report/generate
Body: { "target_date": "2025-01-04" }

# 3. ë¦¬í¬íŠ¸ ì¡°íšŒ
GET /api/v1/report/{store_id}
            """, language="http")

        # 7. Report Agent
        elif selection_key == "feat_report":
            st.header("7. ğŸ¤– Core Feature: Report Agent")
            st.subheader("Data Pipeline + LLM Reasoning")
            
            st.write("ì´ ì—ì´ì „íŠ¸ëŠ” ë‹¨ìˆœíˆ 'ë¶„ì„í•´ì¤˜'ë¼ê³  í”„ë¡¬í”„íŠ¸ë§Œ ì¹˜ëŠ” ê²Œ ì•„ë‹™ë‹ˆë‹¤.")
            st.write("ì—”ì§€ë‹ˆì–´ë§ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì™„ë²½í•˜ê²Œ í†µì œí•©ë‹ˆë‹¤.")
            
            col1, col2 = st.columns(2)
            with col1:
                st.markdown("#### 1. Pre-calculation (Python)")
                st.write("ì´ ë§¤ì¶œ, ì„±ì¥ë¥  ê°™ì€ í•µì‹¬ ìˆ«ìëŠ” íŒŒì´ì¬ìœ¼ë¡œ ì§ì ‘ ê³„ì‚°í•©ë‹ˆë‹¤. (LLM ì—°ì‚° ì˜¤ë¥˜ ë°©ì§€)")
            
            with col2:
                st.markdown("#### 2. Tag Parsing Strategy")
                st.write("JSON íŒŒì‹± ì—ëŸ¬ë¥¼ ë§‰ê¸° ìœ„í•´ `<SECTION>` íƒœê·¸ ë°©ì‹ì„ ë„ì…í•˜ì—¬ ì„±ê³µë¥ ì„ 99.9%ë¡œ ë†’ì˜€ìŠµë‹ˆë‹¤.")

        # 8. Inquiry Agent
        elif selection_key == "feat_inquiry":
            st.header("8. ğŸ’¬ Core Feature: Inquiry Agent")
            st.subheader("Adaptive RAG System")
            
            st.markdown("ì§ˆë¬¸ì˜ ì˜ë„(Intent)ë¥¼ ë¶„ë¥˜í•´ ë„êµ¬ë¥¼ ìŠ¤ìŠ¤ë¡œ ì„ íƒí•©ë‹ˆë‹¤.")
            
            st.write("""
            - **ì‚¬ë‚´ ê·œì • ì§ˆë¬¸**: "ì˜¤í”ˆ ì‹œê°„ ì–¸ì œì•¼?" -> **Vector DB ê²€ìƒ‰ (RAG)**
            - **ì™¸ë¶€ íŠ¸ë Œë“œ ì§ˆë¬¸**: "ìš”ì¦˜ ëœ¨ëŠ” ë””ì €íŠ¸ ë­ì•¼?" -> **Tavily Web Search**
            - **ë³µí•© ì§ˆë¬¸**: "ë¹„ ì˜¤ëŠ” ë‚  ë°°ë‹¬ íŒ ê·œì • ì•Œë ¤ì¤˜" -> **Hybrid Search**
            """)

        # 9. Log #1 AWS
        elif selection_key == "log_aws":
            st.header("ğŸ”¥ Log #1: Connectivity Issue")
            st.error("Issue: AWS ì„œë²„ ë°°í¬ í›„ DB(RDS) ì—°ê²° ê±°ë¶€ (Connection Refused)")
            
            st.write("#### ğŸ•µï¸ Analysis")
            st.write("ë¡œì»¬ ê°œë°œ ì‹œ ì‚¬ìš©í•˜ë˜ SSH í„°ë„ë§ í¬íŠ¸(`5433`) ì„¤ì •ì´ `.env` íŒŒì¼ì— ë‚¨ì•„ ì„œë²„ì— ê·¸ëŒ€ë¡œ ë°°í¬ë¨. ì„œë²„ëŠ” `localhost:5433`ì—ì„œ ì•„ë¬´ê²ƒë„ ì°¾ì„ ìˆ˜ ì—†ìŒ.")
            
            st.success("#### âœ… Solution")
            st.code("""
# Local .env (Tunneling)
DB_URL=postgresql://user:pass@localhost:5433/db

# Server .env (Direct) -> Fix!
DB_URL=postgresql://user:pass@database-aws.rds...:5432/db
            """, language="bash")
            st.write("ì„œë²„ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ê³  `pkill` í”„ë¡œì„¸ìŠ¤ ì •ë¦¬ í›„ ì¬ì‹œë™í•˜ì—¬ í•´ê²°.")

        # 10. Log #2 JSON
        elif selection_key == "log_json":
            st.header("ğŸ”¥ Log #2: LLM JSON Parsing Crash")
            st.error("Issue: LLMì´ JSON í˜•ì‹ì„ ìê¾¸ í‹€ë ¤ì„œ íŒŒì´í”„ë¼ì¸ ì¤‘ë‹¨")
            
            st.write("#### ğŸ•µï¸ Analysis")
            st.write("LLMì€ í™•ë¥ ì  ëª¨ë¸ì´ë¼ Trailing Comma(,) ê°™ì€ ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì™„ë²½íˆ í†µì œí•˜ê¸° ì–´ë ¤ì›€.")
            
            st.success("#### âœ… Solution: Tag Parser ë„ì…")
            st.code("""
# Before (JSON)
{ "summary": "ì¢‹ì•„ìš”", ... } -> ì—ëŸ¬ ë¹ˆë°œ

# After (XML Tags)
<SUMMARY>ì¢‹ì•„ìš”</SUMMARY> -> Regexë¡œ ì¶”ì¶œ (ì„±ê³µë¥  99.9%)
            """, language="python")

        # 11. Log #3 RAG
        elif selection_key == "log_rag":
            st.header("ğŸ”¥ Log #3: RAG Accuracy")
            st.error("Issue: 'ì§ì› ë³µì¥' ê²€ìƒ‰ ì‹œ 'ìœ ë‹ˆí¼' ë¬¸ì„œë¥¼ ëª» ì°¾ìŒ")
            
            st.success("#### âœ… Solution: Hybrid Search")
            st.write("ë‹¨ìˆœ í‚¤ì›Œë“œ ë§¤ì¹­ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ **pgvector(Cosine Similarity)** ê¸°ë°˜ ì˜ë¯¸ ê²€ìƒ‰ì„ ë„ì….")
            st.write("ì´ì œ 'ì˜·', 'ë³µì¥'ì´ë¼ê³  ë¬¼ì–´ë„ 'ìœ ë‹ˆí¼ ê·œì •' ë¬¸ì„œë¥¼ ì •í™•íˆ ì°¾ì•„ëƒ„.")

        # 12. Roadmap
        elif selection_key == "roadmap":
            st.header("12. ğŸš€ Future Roadmap")
            
            st.write("### Self-Correction Loop (ììœ¨ ìˆ˜ì •)")
            st.markdown("""
            í˜„ì¬ì˜ Linear Pipelineì„ ë„˜ì–´, ì—ëŸ¬ ë°œìƒ ì‹œ **"ìŠ¤ìŠ¤ë¡œ ê³ ì³ì™€"**ë¼ê³  ë˜ë¬»ëŠ” ìˆœí™˜ ê·¸ë˜í”„(Cycle)ë¥¼ ë„ì…í•  ì˜ˆì •ì…ë‹ˆë‹¤.
            """)
            st.graphviz_chart("""
            digraph Loop {
                rankdir=LR;
                Parse [label="JSON Parsing"];
                Error [label="Error?", shape=diamond];
                Refine [label="Refine Prompt"];
                Success [label="Save DB"];
                
                Parse -> Error;
                Error -> Success [label="No"];
                Error -> Refine [label="Yes (Retry)"];
                Refine -> Parse;
            }
            """)

        # Raw Doc
        elif selection_key == "raw_doc":
            st.subheader("ğŸ“œ ì›ë³¸ ë¬¸ì„œ (Markdown View)")
            try:
                file_path = os.path.join(os.getcwd(), "docs", "portfolio", "PORTFOLIO_MASTER.md")
                with open(file_path, "r", encoding="utf-8") as f:
                    st.code(f.read(), language="markdown")
            except:
                st.error("íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")



==================================================
FILE_PATH: ui\register.py
==================================================

# app/ui/register.py
import streamlit as st
from api_utils import post_api


def register_page():
    st.title("ğŸ“ Register")

    email = st.text_input("Email")

    if st.button("Register"):
        res_data = post_api("/user/register", json_data={"email": email})

        if res_data:
            st.success("íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.")
            st.session_state.page = "login"
            st.rerun()

    st.button("ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™", on_click=lambda: go_login())


def go_login():
    st.session_state.page = "login"



==================================================
FILE_PATH: ui\review_page.py
==================================================

import streamlit as st
import pandas as pd
from api_utils import get_api

def review_page():
    # ìŠ¤íƒ€ì¼ ì„í¬íŠ¸
    try: from styles import show_metric_card
    except ImportError: from ui.styles import show_metric_card

    st.markdown("<h1>ğŸ’¬ Customer Reviews</h1>", unsafe_allow_html=True)
    st.caption("Review Analysis & Sentiment Monitoring")
    st.divider()

    # 1. ì§€ì  ë°ì´í„° ë¡œë“œ
    stores_data = get_api("/store/get")
    if not stores_data:
        st.warning("ë§¤ì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return

    stores = pd.DataFrame(stores_data)

    # 2. ë§¤ì¥ ì„ íƒ
    selected_store_name = st.selectbox(
        "ë¦¬ë·°ë¥¼ í™•ì¸í•  ë§¤ì¥ì„ ì„ íƒí•˜ì„¸ìš”",
        stores["store_name"]
    )
    store_row = stores[stores["store_name"] == selected_store_name].iloc[0]
    store_id = int(store_row['store_id'])

    st.info(f"ğŸ“ **{selected_store_name}**ì˜ ë¦¬ë·° ëª©ë¡ì…ë‹ˆë‹¤.")

    # 3. ë¦¬ë·° ë°ì´í„° ë¡œë“œ
    reviews_data = get_api(f"/review/store/{store_id}")

    if not reviews_data:
        st.info("í•´ë‹¹ ì§€ì ì— ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    df_reviews = pd.DataFrame(reviews_data)
    df_reviews['created_at'] = pd.to_datetime(df_reviews['created_at'])
    if 'ordered_at' in df_reviews.columns:
        df_reviews['ordered_at'] = pd.to_datetime(df_reviews['ordered_at'])

    # í†µê³„ ìš”ì•½
    col1, col2, col3 = st.columns(3)
    avg_rating = df_reviews['rating'].mean()
    show_metric_card(col1, "í‰ê·  í‰ì ", f"{avg_rating:.1f} / 5.0")
    show_metric_card(col2, "ì´ ë¦¬ë·° ìˆ˜", f"{len(df_reviews)}ê±´")

    high_rating_ratio = (len(df_reviews[df_reviews['rating'] >= 4]) / len(df_reviews)) * 100
    show_metric_card(col3, "ê¸ì • ë¦¬ë·° ë¹„ìœ¨", f"{high_rating_ratio:.1f}%")

    st.divider()

    # 4. ë¦¬ë·° ëª©ë¡ í‘œì‹œ (ì¹´ë“œ í˜•íƒœë‚˜ ë¦¬ìŠ¤íŠ¸)
    for _, row in df_reviews.iterrows():
        with st.container():
            # í‰ì ì— ë”°ë¥¸ ë³„ ëª¨ì–‘ í‘œì‹œ
            stars = "â­" * int(row['rating'])

            # ë°°ë‹¬ ì•± ì•„ì´ì½˜/í…ìŠ¤íŠ¸
            delivery = f"[{row['delivery_app']}]" if row['delivery_app'] else "[ë°©ë¬¸]"

            st.markdown(f"### {stars} {row['rating']}.0")
            st.write(
                f"**ë©”ë‰´:** {row['menu_name']} | **ì‘ì„±ì¼:** {row['created_at'].strftime('%Y-%m-%d %H:%M')}")

            # ì‹¤ì œ ì£¼ë¬¸ ë°ì´í„°ì™€ì˜ ì—°ê²°ì„± í‘œì‹œ
            if pd.notnull(row['ordered_at']):
                st.caption(
                    f"ğŸ”— ì‹¤ì œ ì£¼ë¬¸ì¼: {row['ordered_at'].strftime('%Y-%m-%d %H:%M')}")

            st.info(row['review_text'])
            st.divider()



==================================================
FILE_PATH: ui\sales_component.py
==================================================

import streamlit as st
import pandas as pd
import altair as alt
from datetime import date
from api_utils import get_api
# ìŠ¤íƒ€ì¼ ì„í¬íŠ¸
try:
    from styles import show_metric_card
except ImportError:
    from ui.styles import show_metric_card


@st.dialog("ğŸ“Š ì§€ì  ë§¤ì¶œ ìƒì„¸ í˜„í™©", width="large")
def show_sales_dialog(store_id, store_name):
    """
    ëª¨ë‹¬(ë‹¤ì´ì–¼ë¡œê·¸) ì°½ìœ¼ë¡œ ë§¤ì¶œ í˜„í™©ì„ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
    """
    st.write(f"### {store_name}")
    st.divider()

    # ìƒë‹¨ íƒ­ êµ¬ì„±
    tab1, tab2 = st.tabs(["ğŸ“Š ë§¤ì¶œ í˜„í™©", "ğŸ¤– AI ì „ëµ ë¦¬í¬íŠ¸"])

    with tab1:
        # [Optimize] ë§¤ì¶œ ë°ì´í„° Session State ìºì‹± (ë°˜ë³µ í˜¸ì¶œ ë°©ì§€)
        cache_key_sales = f"cached_sales_{store_id}"
        if cache_key_sales not in st.session_state:
             st.session_state[cache_key_sales] = get_api(f"/order/store/{store_id}/daily_sales")
        
        sales_data = st.session_state[cache_key_sales]

        if sales_data:
            df_sales = pd.DataFrame(sales_data)
            df_sales['order_date'] = pd.to_datetime(
                df_sales['order_date']).dt.date

            if 'daily_revenue' in df_sales.columns:
                df_sales['daily_revenue'] = pd.to_numeric(
                    df_sales['daily_revenue'])

            # ë‚ ì§œ ì„ íƒê¸°ë¥¼ ë¨¼ì € ì •ì˜í•˜ì—¬ ì„ íƒëœ ë‚ ì§œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´ (ì°¨íŠ¸ì—ì„œ ê°•ì¡°í•˜ê¸° ìœ„í•¨)
            max_date = df_sales['order_date'].max()
            min_date = df_sales['order_date'].min()

            # ë ˆì´ì•„ì›ƒ êµ¬ì„±
            col_top1, col_top2 = st.columns([2, 1])
            with col_top2:
                st.write("ğŸ“… **ì¡°íšŒ ë‚ ì§œ ì„ íƒ**")
                selected_date = st.date_input(
                    "ë‚ ì§œ ì„ íƒ",
                    value=max_date,
                    min_value=min_date,
                    max_value=max_date,
                    key=f"modal_date_{store_id}",
                    label_visibility="collapsed"
                )
            
            # --- [NEW] ì›”ê°„ ë§¤ì¶œ í•©ê³„ (ì§„ì‹¤ ê·œëª… ì„¹ì…˜) ---
            # ì„ íƒëœ 'ì›”(Month)'ì˜ ì „ì²´ ë§¤ì¶œì„ ê³„ì‚°í•´ì„œ ë³´ì—¬ì¤Œ
            if selected_date:
                sel_year = selected_date.year
                sel_month = selected_date.month
                
                # í•´ë‹¹ ì›” ë°ì´í„° í•„í„°ë§
                mask_month = (df_sales['order_date'].astype(str).str.startswith(f"{sel_year}-{sel_month:02d}"))
                df_month = df_sales[mask_month]
                
                month_total_rev = df_month['daily_revenue'].sum() if not df_month.empty else 0
                month_total_orders = df_month['total_orders'].sum() if 'total_orders' in df_month.columns else 0
                
                with col_top1:
                    st.info(f"ğŸ’° **{sel_year}ë…„ {sel_month}ì›” ì´ ë§¤ì¶œ**: {int(month_total_rev):,}ì› (ì£¼ë¬¸ {int(month_total_orders):,}ê±´)")
            # ---------------------------------------------

            # 1. ë§¤ì¶œ ê·¸ë˜í”„ (Altairë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€)
            st.write("ğŸ“ˆ **ì¼ë³„ ë§¤ì¶œ ì¶”ì´**")

            # ê°•ì¡° ìƒ‰ìƒ ì„¤ì •ì„ ìœ„í•œ ì»¬ëŸ¼ ì¶”ê°€
            chart_df = df_sales.copy()
            chart_df['is_selected'] = chart_df['order_date'] == selected_date
            chart_df['order_date_str'] = chart_df['order_date'].astype(str)

            # Altair ì°¨íŠ¸ ìƒì„±
            bar_chart = alt.Chart(chart_df).mark_bar().encode(
                x=alt.X('order_date_str:N', title='ë‚ ì§œ',
                        axis=alt.Axis(labelAngle=0)),
                y=alt.Y('daily_revenue:Q', title='ë§¤ì¶œì•¡(ì›)'),
                color=alt.condition(
                    alt.datum.is_selected,
                    alt.value('#FF4B4B'),  # ì„ íƒëœ ë‚ ì§œ (ë¹¨ê°„ìƒ‰ ê°•ì¡°)
                    alt.value('#1f77b4')   # ê¸°ë³¸ ìƒ‰ìƒ (íŒŒë€ìƒ‰)
                ),
                tooltip=[
                    alt.Tooltip('order_date_str:N', title='ë‚ ì§œ'),
                    alt.Tooltip('daily_revenue:Q', title='ë§¤ì¶œì•¡', format=',.0f')
                ]
            ).properties(width='container', height=300)

            st.altair_chart(bar_chart, width='stretch')

            st.divider()

            # 2. ë‚ ì§œë³„ ìƒì„¸ ë‚´ì—­ (ì£¼ë¬¸ ëª©ë¡ ìºì‹±)
            cache_key_orders = f"cached_orders_{store_id}"
            if cache_key_orders not in st.session_state:
                st.session_state[cache_key_orders] = get_api(f"/order/store/{store_id}")
            
            orders_data = st.session_state[cache_key_orders]
            if orders_data:
                df_orders = pd.DataFrame(orders_data)
                df_orders['ordered_at'] = pd.to_datetime(
                    df_orders['ordered_at'])
                mask = (df_orders['ordered_at'].dt.date == selected_date)
                df_day = df_orders[mask]

                if not df_day.empty:
                    st.write(f"ğŸ›’ **{selected_date} ì£¼ë¬¸ ëª©ë¡**")
                    display_df = df_day[['menu_name', 'quantity',
                                        'total_price', 'ordered_at']].copy()
                    display_df['ordered_at'] = display_df['ordered_at'].dt.strftime(
                        '%H:%M')
                    display_df.columns = ['ë©”ë‰´ëª…', 'ìˆ˜ëŸ‰', 'ê¸ˆì•¡', 'ì£¼ë¬¸ì‹œê°„']

                    m1, m2, m3 = st.columns(3)
                    show_metric_card(m1, "ì„ íƒ ë‚ ì§œ", str(selected_date))
                    show_metric_card(m2, "ì´ ì£¼ë¬¸", f"{len(df_day)}ê±´")
                    show_metric_card(m3, "ì´ ë§¤ì¶œ", f"{int(df_day['total_price'].sum()):,}ì›")

                    st.dataframe(display_df, width='stretch',
                                 hide_index=True)
                else:
                    st.info(f"{selected_date} ì—ëŠ” ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.")
        else:
            st.warning("ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    with tab2:
        st.write("### ğŸ¤– AI ì§€ì  ê²½ì˜ ì „ëµ ë¦¬í¬íŠ¸")
        st.write("ì§€ì ì˜ ë§¤ì¶œê³¼ ê³ ê° ë¦¬ë·°ë¥¼ ë¶„ì„í•˜ì—¬ AI ì»¨ì„¤í„´íŠ¸ê°€ ìµœì ì˜ ìš´ì˜ ì „ëµì„ ì œì•ˆí•©ë‹ˆë‹¤.")

        # ì£¼ì°¨ë³„ ë¶„ì„ì„ ìœ„í•œ ë‚ ì§œ ì˜µì…˜ ìƒì„±
        # sales_dataëŠ” tab1ì—ì„œ ì´ë¯¸ ë¡œë“œë¨ (get_api)
        report_target_date = None
        
        if 'df_sales' in locals() and not df_sales.empty:
            max_d = df_sales['order_date'].max() # DB ìƒ ìµœì‹  ë‚ ì§œ (ì˜ˆ: 12ì›” 30ì¼)
            min_d = df_sales['order_date'].min()
            
            # [Fix] ì‚¬ìš©ì ìš”ì²­: 12ì›” 4ì¼ë¶€í„° 31ì¼ê¹Œì§€ 1ì£¼ ë‹¨ìœ„ ê°•ì œ ê³ ì •
            # 1ì£¼ì°¨: 12.04 ~ 12.10
            # 2ì£¼ì°¨: 12.11 ~ 12.17
            # 3ì£¼ì°¨: 12.18 ~ 12.24
            # 4ì£¼ì°¨: 12.25 ~ 12.31
            
            # [Dynamic] ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ê¸°ê°„ì„ ê¸°ì¤€ìœ¼ë¡œ 'ì›”ìš”ì¼~ì¼ìš”ì¼' ì£¼ì°¨ ìë™ ìƒì„±
            week_options = {}
            default_ix = 0
            
            # íƒ€ê²Ÿ ë‚ ì§œ (ì´ì „ íƒ­ì—ì„œ ì„ íƒëœ ë‚ ì§œ)
            target_obj = selected_date if 'selected_date' in locals() and selected_date else None
            
            # ë™ì  ì£¼ì°¨ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            dynamic_weeks = []
            
            from datetime import timedelta
            
            curr_start = min_d
            current_month = curr_start.month
            week_num = 1
            
            # ë°ì´í„° ë ë‚ ì§œê¹Œì§€ ë£¨í”„
            while curr_start <= max_d:
                # ì›”ì´ ë°”ë€Œì—ˆëŠ”ì§€ ì²´í¬í•˜ì—¬ ì£¼ì°¨ ë²ˆí˜¸ ë¦¬ì…‹
                if curr_start.month != current_month:
                    current_month = curr_start.month
                    week_num = 1
                
                # ì´ë²ˆ ì£¼ ì¼ìš”ì¼ ì°¾ê¸° (ì›”=0, ... ì¼=6)
                days_left = 6 - curr_start.weekday()
                curr_end_ideal = curr_start + timedelta(days=days_left)
                
                # ì‹¤ì œ ë°ì´í„° ë²”ìœ„ ë‚´ì—ì„œ ëŠê¸° (max_dë¥¼ ë„˜ì–´ê°€ë©´ max_dê¹Œì§€ë§Œ)
                real_end = min(curr_end_ideal, max_d)
                
                # [User Rule] 5ì£¼ì°¨ëŠ” ì œì™¸í•˜ê³  1~4ì£¼ì°¨ë§Œ í‘œì‹œ
                if week_num <= 4:
                    dynamic_weeks.append((curr_start, real_end, current_month, week_num))
                
                # ë‹¤ìŒ ë£¨í”„ ì¤€ë¹„ (ë‹¤ìŒì£¼ ì›”ìš”ì¼)
                curr_start = curr_end_ideal + timedelta(days=1)
                week_num += 1

            # ìµœì‹  ì£¼ì°¨ê°€ ìœ„ë¡œ ì˜¤ë„ë¡ ì—­ìˆœ ì •ë ¬í•˜ì—¬ ì˜µì…˜ ìƒì„±
            for i, (s_date, e_date, month, w_num) in enumerate(reversed(dynamic_weeks)):
                label = f"{s_date.year}ë…„ {month}ì›” {w_num}ì£¼ì°¨ ({s_date.strftime('%m.%d')} ~ {e_date.strftime('%m.%d')})"
                # ë¦¬í¬íŠ¸ APIì—ëŠ” í•´ë‹¹ ì£¼ì°¨ì˜ ë§ˆì§€ë§‰ ë‚ ì§œ(ë°ì´í„° ê¸°ì¤€)ë¥¼ ì „ì†¡
                week_options[label] = str(e_date)
                
                # ë””í´íŠ¸ ì„ íƒ ë¡œì§ (ì„ íƒëœ ë‚ ì§œê°€ í¬í•¨ëœ ì£¼ì°¨ ìë™ ì„ íƒ)
                if target_obj and s_date <= target_obj <= e_date:
                    default_ix = i

            # UI: ì£¼ì°¨ ì„ íƒ ë°•ìŠ¤
            st.markdown("##### ğŸ“… ë¶„ì„ ë°”ìš´ë”ë¦¬(ê¸°ê°„) ì„¤ì •")
            
            options_list = list(week_options.keys())
            
            selected_label = st.selectbox(
                "ë¶„ì„í•  ì£¼ì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”", 
                options=options_list,
                index=default_ix if default_ix < len(options_list) else 0,
                key=f"report_week_select_{store_id}",
                label_visibility="collapsed"
            )
            report_target_date = week_options[selected_label]
            
        # [Refactor] ì™„ì „í•œ On-Demand ë°©ì‹ (ì´ˆê¸° ë¡œë”© X, ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ ìƒì„±/ì¡°íšŒ)
        state_key_report = f"report_data_{store_id}"
        state_key_date = f"last_target_date_{store_id}"
        
        # 1. ë‚ ì§œ ë³€ê²½ ê°ì§€ -> ë¦¬í¬íŠ¸ ì´ˆê¸°í™”
        # (ì‚¬ìš©ìê°€ ì£¼ì°¨ë¥¼ ë°”ê¾¸ë©´ ê¸°ì¡´ ë¦¬í¬íŠ¸ëŠ” ì˜ë¯¸ê°€ ì—†ìœ¼ë¯€ë¡œ í™”ë©´ì—ì„œ ì¦‰ì‹œ ì œê±°)
        current_loaded_date = st.session_state.get(state_key_date)
        
        if current_loaded_date != str(report_target_date):
            st.session_state[state_key_report] = None
            st.session_state[state_key_date] = str(report_target_date)
            # ë¡œê·¸ë„ í•¨ê»˜ ì´ˆê¸°í™”
            st.session_state.pop(f"last_logs_{store_id}", None)
            
        # 2. Session Stateì—ì„œ ë°ì´í„° ë¡œë“œ (ì—†ìœ¼ë©´ None -> ë²„íŠ¼ë§Œ ë³´ì„)
        report_data = st.session_state.get(state_key_report)

        col_btn1, col_btn2 = st.columns([1, 2])
        if col_btn1.button("âœ¨ ì„ íƒ ê¸°ê°„ ë¦¬í¬íŠ¸ ìƒì„±", key=f"gen_report_{store_id}"):
            with st.spinner(f"AIê°€ {report_target_date} ê¸°ì¤€ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
                from api_utils import post_api
                
                # Payload ìƒì„±
                payload = {
                     "store_id": int(store_id), # [Fix] int64 -> int ë³€í™˜ (JSON ì§ë ¬í™” ì˜¤ë¥˜ ë°©ì§€)
                     "store_name": store_name,
                     "target_date": report_target_date
                }
                
                # ìƒì„± ìš”ì²­ (ë°±ì—”ë“œì—ì„œ ìºì‹œ ì²´í¬ í•¨)
                # post_api ë‚´ë¶€ì—ì„œ API_BASE_URL ì²˜ë¦¬ë¨
                result = post_api("/report/generate", payload)
                
                if result: 
                    # ì„±ê³µ ì‹œ State ì—…ë°ì´íŠ¸
                    st.session_state[f"last_logs_{store_id}"] = result.get("logs", [])
                    st.session_state[state_key_report] = result.get("report")
                    report_data = result.get("report")
                    
                    # ìºì‹œ/ìƒì„± ì„±ê³µ ë©”ì‹œì§€
                    if result.get("cached"):
                        st.info("âš¡ ì´ì „ì— ìƒì„±ëœ ë¦¬í¬íŠ¸ê°€ ìˆì–´ ì¦‰ì‹œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.")
                    else:
                        st.success(f"{report_target_date} ê¸°ì¤€ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!")
                        st.toast("AI ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ!", icon="âœ¨")

                    # ì‹¤í–‰ ë¡œê·¸ ë³´ì—¬ì£¼ê¸°
                    if "logs" in result and result["logs"]:
                        with st.expander("ğŸ“œ AI ì‹¤í–‰ ë¡œê·¸ í™•ì¸", expanded=True):
                            for log in result["logs"]:
                                st.code(log)
                else:
                    st.error("ë¦¬í¬íŠ¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")

        # [NEW] ë¦¬í¬íŠ¸ ì´ˆê¸°í™” ë²„íŠ¼
        if col_btn2.button("ğŸ—‘ï¸ ë¦¬í¬íŠ¸ ì´ˆê¸°í™”", key=f"reset_report_{store_id}"):
            import requests
            from api_utils import API_BASE_URL
            try:
                resp = requests.delete(f"{API_BASE_URL}/report/reset/{store_id}")
                if resp.status_code == 200:
                    st.toast("ë¦¬í¬íŠ¸ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", icon="ğŸ—‘ï¸")
                    st.rerun() # ìƒˆë¡œê³ ì¹¨í•´ì„œ ì´ˆê¸°í™”ëœ ìƒíƒœ ë°˜ì˜
                else:
                    st.error("ì´ˆê¸°í™” ì‹¤íŒ¨")
            except Exception as e:
                st.error(f"Error: {e}")

        if report_data:
            st.divider()
            
            # report_dateëŠ” ë³´í†µ ë¬¸ìì—´(YYYY-MM-DD)ë¡œ ì˜´
            from datetime import datetime, timedelta
            
            # ì¶œì²˜(Source) ë³€ìˆ˜ ë³µêµ¬
            source = report_data.get("source", "db")
            
            try:
                # [ìˆ˜ì •] ì‚¬ìš©ìê°€ ì„ íƒí•œ ë‚ ì§œ(report_target_date)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸°ê°„ í‘œì‹œ
                # report_target_dateëŠ” ìœ„ì—ì„œ ì´ë¯¸ ì •ì˜ë¨ (ì˜ˆ: "2025-12-10")
                if report_target_date:
                    end_date = datetime.strptime(report_target_date, "%Y-%m-%d")
                    start_date = end_date - timedelta(days=6)
                    
                    header_text = f"{end_date.year}ë…„ {end_date.month}ì›” {end_date.day}ì¼ ê¸°ì¤€ ì£¼ì°¨ ({start_date.strftime('%m.%d')} ~ {end_date.strftime('%m.%d')})"
                    
                    # 1. ë©”ì¸ í—¤ë”ë¡œ ê¸°ê°„ í‘œì‹œ
                    st.subheader(f"ğŸ“‘ {header_text}")
                else:
                    # ì„ íƒëœ ë‚ ì§œê°€ ì—†ëŠ” ê²½ìš°(ìµœì´ˆ ë¡œë”© ë“±) DB ë°ì´í„° ì‚¬ìš© Fallback
                    st.subheader(f"ğŸ“‘ ë¦¬í¬íŠ¸ ì •ë³´: {report_data.get('report_date')}")
                
                # 2. ì¶œì²˜ ë°°ì§€ (ì‘ê²Œ)
                if source == "cache":
                    st.caption(f":blue-background[âš¡ CACHE] ë°ì´í„° ê¸°ë°˜ ë¶„ì„")
                else:
                    st.caption(f":gray-background[ğŸ“ DATABASE] ë°ì´í„° ê¸°ë°˜ ë¶„ì„")
                    
            except Exception:
                # ë‚ ì§œ íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê·¸ëŒ€ë¡œ ì¶œë ¥ (header_text ì‚¬ìš© ë¶ˆê°€)
                 st.subheader(f"ğŸ“‘ ë¦¬í¬íŠ¸ ì •ë³´: {report_data.get('report_date')}")

            # --- ì‹ ê·œ: ë°ì´í„° ë¶„ì„ ê·¼ê±° ì‹œê°í™” ---
            # DBì—ì„œ ë¶ˆëŸ¬ì˜¬ ê²½ìš° risk_assessment ì•ˆì— metricsê°€ ë“¤ì–´ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ í™•ì¸
            risk_data = report_data.get("risk_assessment", {}) or {}
            metrics = report_data.get("metrics") or risk_data.get("metrics")
            evidence = report_data.get("data_evidence") or risk_data.get("data_evidence")

            if metrics:
                st.markdown("#### ğŸ“Š ë°ì´í„° ë¶„ì„ ê·¼ê±°")
                m_col1, m_col2, m_col3 = st.columns(3)
                
                total_rev = metrics.get('total_rev', 0)
                trend = metrics.get('trend_percent', 0)
                rating = metrics.get('avg_rating', 0)
                
                show_metric_card(m_col1, "ì´ ë§¤ì¶œ (7ì¼)", f"{int(total_rev):,}ì›")
                show_metric_card(m_col2, "ë§¤ì¶œ ë³€ë™ ì¶”ì„¸", f"{trend:+.1f}%", delta=f"{trend:.1f}%")
                show_metric_card(m_col3, "í‰ê·  ë¦¬ë·° í‰ì ", f"{rating:.1f} / 5.0")
                
                # --- ì‹ ê·œ: ë¶„ì„ì— ì‚¬ìš©ëœ ë¡œìš° ë°ì´í„°(Raw Data) ì‹œê°í™” ---
                source_data = report_data.get("source_data") or risk_data.get("source_data")
                if source_data and "recent_sales" in source_data:
                    with st.expander("ğŸ“ Raw Data Analysis (Source)", expanded=False):
                        st.write("AIê°€ ë¶„ì„ì˜ ê·¼ê±°ë¡œ í™œìš©í•œ ì„¸ë¶€ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
                        
                        t1, t2 = st.tabs(["ğŸ“Š ë§¤ì¶œ/ë‚ ì”¨ í†µí•©", "ğŸ” ë©”ë‰´ë³„ ë¶„ì„"])
                        
                        with t1:
                            st.write("**[ìµœê·¼ 7ì¼ ë§¤ì¶œ ë° ê¸°ìƒ ìƒí™©]**")
                            df_source_sales = pd.DataFrame(source_data["recent_sales"])
                            
                            # ì»¬ëŸ¼ëª… ë§¤í•‘
                            col_map = {"date": "ë‚ ì§œ", "revenue": "ë§¤ì¶œì•¡(ì›)", "rev": "ë§¤ì¶œì•¡(ì›)", "weather": "ë‚ ì”¨"}
                            df_source_sales = df_source_sales.rename(columns=col_map)
                            
                            # ì»¬ëŸ¼ ìˆœì„œ ì •ë¦¬ (ë‚ ì§œ, ë‚ ì”¨, ë§¤ì¶œì•¡ ìˆœ)
                            cols = [c for c in ["ë‚ ì§œ", "ë‚ ì”¨", "ë§¤ì¶œì•¡(ì›)"] if c in df_source_sales.columns]
                            st.dataframe(df_source_sales[cols], hide_index=True, use_container_width=True)

                        with t2:
                            col_m1, col_m2 = st.columns(2)
                            with col_m1:
                                st.write("**ğŸ”¥ ì˜ íŒ”ë¦¬ëŠ” ë©”ë‰´ (Top 5)**")
                                if "top_selling_menus" in source_data:
                                    df_top = pd.DataFrame(source_data["top_selling_menus"])
                                    if not df_top.empty:
                                        st.dataframe(df_top[["menu", "recent_rev", "change_pct"]].rename(columns={"menu":"ë©”ë‰´","recent_rev":"ë§¤ì¶œ","change_pct":"ì¦ê°%"}), hide_index=True)
                                    else:
                                        st.write("- ë°ì´í„° ì—†ìŒ -")
                            
                            with col_m2:
                                st.write("**ğŸ“‰ ê¸‰ê°í•œ ë©”ë‰´ (Worst 5)**")
                                if "worst_dropping_menus" in source_data:
                                    df_worst = pd.DataFrame(source_data["worst_dropping_menus"])
                                    if not df_worst.empty:
                                        st.dataframe(df_worst[["menu", "change_pct", "prev_rev"]].rename(columns={"menu":"ë©”ë‰´","change_pct":"í•˜ë½%","prev_rev":"ì´ì „ë§¤ì¶œ"}), hide_index=True)
                                    else:
                                        st.write("- ë°ì´í„° ì—†ìŒ -")
                # --------------------------------------------------

                if evidence:
                    with st.expander("ğŸ§ AIê°€ ë¶„ì„í•œ ì„¸ë¶€ ê·¼ê±° ë³´ê¸°"):
                        # [FIX] ë§ˆí¬ë‹¤ìš´ í…Œì´ë¸”/í—¤ë”ê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡ ì¤„ë°”ê¿ˆ ì¶”ê°€
                        st.markdown(f"**ë§¤ì¶œ ë¶„ì„:**\n\n{evidence.get('sales_analysis')}")

            # -------------------------------

            st.markdown("#### ğŸ“ ì¢…í•© ë¶„ì„ ìš”ì•½")
            st.success(report_data['summary'])

            st.markdown("#### ğŸ’¡ ë§ˆì¼€íŒ… ë° í”„ë¡œëª¨ì…˜ ì „ëµ")
            st.write(report_data['marketing_strategy'])

            st.markdown("#### ğŸ› ï¸ í˜„ì¥ ìš´ì˜ ê°œì„  ì œì•ˆ")
            st.write(report_data['operational_improvement'])

            # ìœ„í—˜ ìš”ì†Œ ì‹œê°í™”
            risk = report_data.get('risk_assessment', {})
            if risk:
                st.markdown("#### âš ï¸ ë¦¬ìŠ¤í¬ ì§„ë‹¨")
                risk_score = risk.get('risk_score', 0)
                st.progress(risk_score / 100, text=f"ìœ„í—˜ ì§€ìˆ˜: {risk_score}ì ")

                cols = st.columns(len(risk.get('main_risks', [])) or 1)
                for i, r_text in enumerate(risk.get('main_risks', [])):
                    cols[i].warning(r_text)

                st.error(f"**ê¸´ê¸‰ ì œì–¸:** {risk.get('suggestion', 'N/A')}")
        else:
            st.warning("ì•„ì§ ìƒì„±ëœ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ AI ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”.")

    if st.button("ë‹«ê¸°"):
        st.rerun()



==================================================
FILE_PATH: ui\styles.py
==================================================

import streamlit as st

def apply_custom_styles():
    """
    í¬íŠ¸í´ë¦¬ì˜¤ìš© í”„ë¦¬ë¯¸ì—„ CSS ìŠ¤íƒ€ì¼ ì ìš©
    - í°íŠ¸: Pretendard
    - í…Œë§ˆ: Modern Dark AI Dashboard
    """
    st.markdown("""
        <style>
            /* 1. ì›¹í°íŠ¸ ë¡œë“œ (Pretendard) */
            @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css");

            html, body, [class*="css"] {
                font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif !important;
            }

            /* 2. ì „ì²´ ë°°ê²½ ë° ë©”ì¸ ì»¨í…Œì´ë„ˆ */
            .stApp {
                background-color: #0E1117; /* Deep Dark Background */
            }
            
            /* Sidebar ìŠ¤íƒ€ì¼ */
            [data-testid="stSidebar"] {
                background-color: #161B22;
                border-right: 1px solid #30363D;
            }

            /* 3. í—¤ë” íƒ€ì´í‹€ ìŠ¤íƒ€ì¼ (ê·¸ë¼ë””ì–¸íŠ¸ í…ìŠ¤íŠ¸) */
            h1 {
                background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                font-weight: 800 !important;
                letter-spacing: -0.02em;
                margin-bottom: 0.5rem !important;
            }
            
            /* 4. Expander (ì•„ì½”ë””ì–¸) ìŠ¤íƒ€ì¼ Upgrade */
            .streamlit-expanderHeader {
                background-color: #1F242C !important;
                border-radius: 10px !important;
                border: 1px solid #30363D !important;
                color: #E6EDF3 !important;
                font-size: 15px !important;
                font-weight: 600 !important;
                transition: all 0.2s ease-in-out;
            }
            .streamlit-expanderHeader:hover {
                border-color: #4facfe !important;
                color: #4facfe !important;
            }
            .streamlit-expanderContent {
                background-color: #161B22 !important;
                border: 1px solid #30363D;
                border-top: none;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
                padding: 1rem !important;
            }
            
            /* Expander ë‚´ë¶€ì˜ ëª»ìƒê¸´ í™”ì‚´í‘œ ì•„ì´ì½˜ ìˆ¨ê¸°ê¸°/êµì²´ */
            /* Streamlit êµ¬ì¡°ìƒ ì™„ë²½ ì œì–´ëŠ” ì–´ë µì§€ë§Œ ìµœëŒ€í•œ ìˆ¨ê¹€ */
            .streamlit-expanderHeader svg {
                display: none !important; /* ê¸°ë³¸ ì•„ì´ì½˜ ìˆ¨ê¹€ */
            }
            .streamlit-expanderHeader::after {
                content: "ğŸ”½"; /* ëŒ€ì²´ ì•„ì´ì½˜ */
                margin-left: auto;
                font-size: 12px;
                opacity: 0.7;
            }

            /* 5. Chat Message (ë§í’ì„ ) ìŠ¤íƒ€ì¼ */
            [data-testid="stChatMessage"] {
                background-color: transparent !important;
                padding: 1rem 0;
            }
            /* User Message */
            [data-testid="stChatMessage"][data-testid="user"] {
                flex-direction: row-reverse;
            }
            [data-testid="chatAvatarIcon-user"] {
                background-color: #4facfe !important;
            }
            
            /* AI Message Container (ë‚´ìš© ë°•ìŠ¤) */
            div[data-testid="stChatMessageContent"] {
                background-color: #1F242C;
                border: 1px solid #30363D;
                border-radius: 16px;
                padding: 1.5rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }

            /* 6. Custom Card Styling (HTML/CSSë¡œ ì§ì ‘ ê·¸ë¦¬ëŠ” ìš”ì†Œë“¤) */
            .metric-card {
                background: linear-gradient(135deg, #1F242C 0%, #161B22 100%);
                border: 1px solid #30363D;
                border-radius: 12px;
                padding: 16px;
                text-align: center;
                transition: transform 0.2s;
            }
            .metric-card:hover {
                transform: translateY(-2px);
                border-color: #4facfe;
            }
            .metric-label {
                font-size: 0.85rem;
                color: #8B949E;
                margin-bottom: 4px;
            }
            .metric-value {
                font-size: 1.5rem;
                font-weight: 700;
                color: #E6EDF3;
            }
            .metric-delta {
                font-size: 0.8rem;
                font-weight: 600;
            }
            .delta-up { color: #3FB950; }
            .delta-down { color: #FF7B72; }

            /* 7. Button Style (Primary) */
            div.stButton > button:first-child {
                background: linear-gradient(90deg, #2563EB 0%, #1D4ED8 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                padding: 0.5rem 1rem;
                transition: all 0.2s;
            }
            div.stButton > button:first-child:hover {
                background: linear-gradient(90deg, #1D4ED8 0%, #1E40AF 100%);
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
                transform: scale(1.02);
            }
            /* Secondary Button (Outline) */
            div[data-testid="stForm"] button, div.stButton > button.secondary {
                background: transparent;
                border: 1px solid #30363D;
                color: #E6EDF3;
            }

            /* 10. ê°€ë…ì„± ê°œì„  (Bright Text Mode) */
            p, li, span, div {
                color: #E6EDF3; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ë¥¼ ë°ì€ íšŒìƒ‰/í°ìƒ‰ì— ê°€ê¹ê²Œ */
                line-height: 1.6;
            }
            
            /* í—¤ë” ê°€ë…ì„± ê°•í™” */
            h1, h2, h3, h4, h5, h6 {
                color: #FFFFFF !important;
            }
            
            /* Metric Labelë„ ì¢€ ë” ë°ê²Œ */
            .metric-label {
                color: #C9D1D9 !important;
            }
            
            /* ëª¨ë°”ì¼ ëŒ€ì‘ (ë°˜ì‘í˜•) */
            @media (max-width: 768px) {
                html, body, [class*="css"] {
                    font-size: 16px !important; /* ê¸°ë³¸ í°íŠ¸ ì‚¬ì´ì¦ˆ Up */
                }
                
                h1 {
                    font-size: 1.8rem !important;
                }
                h2 {
                    font-size: 1.5rem !important;
                }
                h3 {
                    font-size: 1.3rem !important;
                }
                
                /* ëª¨ë°”ì¼ì—ì„œ ì¹´ë“œ íŒ¨ë”© ì¶•ì†Œ */
                .metric-card {
                    padding: 12px !important;
                }
                .metric-value {
                    font-size: 1.3rem !important;
                }
                
                /* ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ë³´ */
                div.stButton > button {
                    min-height: 50px; 
                    font-size: 1rem !important;
                }
                
                /* ì…ë ¥ì°½ í…ìŠ¤íŠ¸ ì§„í•˜ê²Œ */
                input, textarea {
                    color: #FFFFFF !important;
                    font-weight: 500 !important;
                }
            }
        </style>
    """, unsafe_allow_html=True)

def show_metric_card(col, label, value, delta=None):
    """
    Custom HTML Metric Card
    Streamlit ê¸°ë³¸ st.metricë³´ë‹¤ ì˜ˆìœ ì¹´ë“œ í˜•íƒœ
    """
    delta_html = ""
    if delta:
        color_class = "delta-up" if "+" in str(delta) or float(str(delta).replace("%","").replace(",","")) > 0 else "delta-down"
        delta_html = f'<div class="metric-delta {color_class}">{delta}</div>'
    
    html = f"""
    <div class="metric-card">
        <div class="metric-label">{label}</div>
        <div class="metric-value">{value}</div>
        {delta_html}
    </div>
    """
    col.markdown(html, unsafe_allow_html=True)


